define("lib/core/chaos/zepto",function(require,t,e){var n=require("lib/core/zepto/zepto");require("lib/core/zepto/event"),require("lib/core/zepto/touch"),require("lib/core/zepto/ajax"),require("lib/core/extra/zepto/zepto"),require("lib/core/extra/zepto/prefixfree"),require("lib/core/extra/zepto/transform"),require("lib/core/extra/zepto/transit"),e.exports=n}),define("mods/view/scene",function(require,t,e){var n=(require("lib"),require("lib/mvc/view")),i=require("lib/kit/util/template"),o=require("mods/model/scene"),s=require("mods/view/coordinateSystem"),r=require("mods/view/house"),a=require("mods/model/person"),c=require("mods/ctrl/env"),l=require("mods/ctrl/preload"),h=(i({loading:['<div class="logo-loading" data-role="loading">','<div class="logo-box">','<img src="images/logo/sina.png"/>',"</div>",'<div data-role="loading-info">','<span data-role="loading-cur"></span>'," / ",'<span data-role="loading-all"></span>',"</div>","</div>"]}),n.extend({defaults:{name:"scene",path:"",node:null,isSightDevice:!1,type:"front"},build:function(){var t=this.conf;this.path=[t.path,t.name].join("."),this.model=new o({type:t.type}),this.personModel=new a,this.setPerspective(),this.buildEnv(),this.buildCoordinateSystem(),this.setStyles(),this.buildHouse(),this.startPreload()},setEvents:function(t){this.delegate(t);var e=(this.conf,this.model),n=this.proxy();e.on("change:perspective",n("setPerspective")),e.on("change:perspectiveOrigin",n("setPerspective"))},setPerspective:function(){var t=this.model;this.role("root").css({perspective:t.get("perspective")+"px","perspective-origin":t.get("perspectiveOrigin")})},buildEnv:function(){this.env=new c({scene:this})},startPreload:function(){l.start()},buildCoordinateSystem:function(){var t=this.conf;this.coordinateSystem=new s({path:this.path,env:this.env,isSightDevice:t.isSightDevice,personModel:this.personModel,parent:this.role("root")})},buildHouse:function(){this.house=new r({path:this.path,env:this.env,personModel:this.personModel,coordinateSystem:this.coordinateSystem})},setStyles:function(){var t=this.conf;if(!t.isSightDevice){var e=this.role("root"),n=e.parent(),i=e.width(),o=e.height(),s=Math.min(i,o),r=1;300>=s?r=1:(r=s/300,s=300),e.css({position:"absolute",top:0,left:0,bottom:0,right:0,margin:"auto",width:s+"px",height:Math.floor(4*s/3)+"px","transform-origin":"50% 50%",transform:"rotateZ(-90deg) scale("+r+")"}),n.css({position:"absolute"})}},getObjByPath:function(t){if(t=t||"",t===this.path)return this;for(var e=new RegExp("^"+this.path+"\\."),n=t.replace(e,""),i=n.split("."),o=this,s="";i.length&&o;)s=i.shift(),o=o.get?o.get(s):o[s];return o&&o.path===t?o:void 0},update:function(t){t=t||{},this.personModel&&this.personModel.set(t.person),this.coordinateSystem&&this.coordinateSystem.update(t.coordinateSystem),this.house&&this.house.update(t.house)},toJSON:function(){var t={};return this.personModel&&(t.person=this.personModel.toJSON()),this.coordinateSystem&&(t.coordinateSystem=this.coordinateSystem.toJSON()),this.house&&(t.house=this.house.toJSON()),t}}));e.exports=h}),define("mods/view/touchPad",function(require,t,e){var n=(require("lib"),require("lib/mvc/view")),i=require("mods/model/touchPad"),o=require("mods/channel/socket"),s=n.extend({defaults:{node:null},build:function(){this.model=i,this.startAlpha=0,this.curAlpha=0,this.offsetAlpha=0},setEvents:function(t){this.delegate(t);var e=this.proxy(),n=this.role("root"),i=this.model;n.get(0)?(window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",e("orientation")),i.on("change",e("sync"))):o.on("touchpad:sync",e("onSync")),i.on("change:lockAlpha",e("computeOffsetAlpha")),n.on("touchstart",e("onTouchStart")),n.on("touchmove",e("onTouchMove")),n.on("touchend",e("onTouchEnd")),n.on("gesturestart",e("onGestureStart")),n.on("gesturechange",e("onGestureChange")),n.on("gestureend",e("onGestureEnd")),n.on("tap",e("triggerTap"))},preventDefault:function(t){t.preventDefault&&t.preventDefault()},onTouchStart:function(t){this.endingAction="",this.preventDefault(t),this.checkAlphaLock(t),t.touches.length>=2?(this.startX0=t.touches[0].pageX,this.startX1=t.touches[1].pageX,this.startY0=t.touches[0].pageY,this.startY1=t.touches[1].pageY):1===t.touches.length&&o.trigger("touchpad:event",{type:"touchstart",x:t.touches[0].pageX,y:t.touches[0].pageY})},onTouchMove:function(t){this.preventDefault(t),t.touches.length>=2?(this.moveX0=t.touches[0].pageX,this.moveX1=t.touches[1].pageX,this.moveY0=t.touches[0].pageY,this.moveY1=t.touches[1].pageY):1===t.touches.length&&o.trigger("touchpad:event",{type:"touchmove",x:t.touches[0].pageX,y:t.touches[0].pageY})},onTouchEnd:function(t){this.preventDefault(t),this.checkAlphaLock(t),this.checkPushPull(t),this.endingAction||o.trigger("touchpad:event",{type:"touchend"})},onGestureStart:function(t){this.preventDefault(t),t=t.originalEvent||t},onGestureChange:function(t){this.preventDefault(t),t=t.originalEvent||t},onGestureEnd:function(t){this.preventDefault(t),t=t.originalEvent||t,this.checkZoomOut(t)},checkPushPull:function(t){if(null!==this.startX0&&null!==this.startX1&&null!==this.startY0&&null!==this.startY1&&t.touches.length<=1){var e=this.moveX0-this.startX0,n=this.moveY0-this.startY0,i=this.moveX1-this.startX1,s=this.moveY1-this.startY1;n>100&&s>100&&e<Math.abs(n/2)&&e>-Math.abs(n/2)&&i<Math.abs(s/2)&&i>-Math.abs(s/2)?(o.trigger("touchpad:event",{type:"pull"}),this.endingAction="pull"):-100>n&&-100>s&&e<Math.abs(n/2)&&e>-Math.abs(n/2)&&i<Math.abs(s/2)&&i>-Math.abs(s/2)&&(o.trigger("touchpad:event",{type:"push"}),this.endingAction="push"),this.startX0=null,this.startX1=null,this.startY0=null,this.startY1=null}},computeOffsetAlpha:function(){var t=this.model,e=0;t.get("lockAlpha")?this.startAlpha=this.curAlpha:(e=this.curAlpha-this.startAlpha,e=e>-180?e:360+e,e=180>e?e:e-360,this.offsetAlpha=e+this.offsetAlpha)},checkAlphaLock:function(t){var e=this.model;"touchstart"===t.type&&3===t.touches.length?e.set("lockAlpha",!0):e.set("lockAlpha",!1)},orientation:function(t){var e=this.model,n=t.alpha,i={beta:t.beta,gamma:t.gamma};this.curAlpha=n,e.get("lockAlpha")||(n-=this.offsetAlpha,n=n>0?n:360+n,n=360>n?n:n-360,i.alpha=n),this.model.set(i)},checkZoomOut:function(t){t.scale<.5?(o.trigger("touchpad:event",{type:"pinch-out"}),this.endingAction="pinch-out"):t.scale>2&&(o.trigger("touchpad:event",{type:"pinch-in"}),this.endingAction="pinch-in")},triggerTap:function(){o.trigger("touchpad:event",{type:"tap"}),this.endingAction="tap"},sync:function(){var t=this.model.get();o.trigger("touchpad:sync",t)},onSync:function(t){t=t||{},this.model.set(t)}});e.exports=s}),define("mods/channel/socket",function(require,t,e){var n=require("lib"),i=require("lib/more/events"),o=require("mods/socket/client"),s=require("lib/kit/util/timer");o.init();var r=new i,a={},c=null;s.setInterval(function(){c&&o.set(c),c=null}),a.trigger=function(t,e){t=t||"",e=e||{},c||(c={}),c[t]=e},a.on=function(){r.on.apply(r,arguments)},a.off=function(){r.off.apply(r,arguments)},o.on("update",function(t){t=t||{},n.each(t,function(t,e){e=e||{},t&&r.trigger(t,e)})}),e.exports=a}),define("lib/core/zepto/zepto",function(require,t,e){var n=function(){function t(t){return null==t?String(t):B[U.call(t)]||"object"}function e(e){return"function"==t(e)}function n(t){return null!=t&&t==t.window}function i(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function o(e){return"object"==t(e)}function s(t){return o(t)&&!n(t)&&Object.getPrototypeOf(t)==Object.prototype}function r(t){return"number"==typeof t.length}function a(t){return O.call(t,function(t){return null!=t})}function c(t){return t.length>0?P.fn.concat.apply([],t):t}function l(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function h(t){return t in z?z[t]:z[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function u(t,e){return"number"!=typeof e||C[l(t)]?e:e+"px"}function d(t){var e,n;return D[t]||(e=A.createElement(t),A.body.appendChild(e),n=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==n&&(n="block"),D[t]=n),D[t]}function f(t){return"children"in t?j.call(t.children):P.map(t.childNodes,function(t){return 1==t.nodeType?t:void 0})}function p(t,e,n){for(k in e)n&&(s(e[k])||G(e[k]))?(s(e[k])&&!s(t[k])&&(t[k]={}),G(e[k])&&!G(t[k])&&(t[k]=[]),p(t[k],e[k],n)):e[k]!==y&&(t[k]=e[k])}function g(t,e){return null==e?P(t):P(t).filter(e)}function m(t,n,i,o){return e(n)?n.call(t,i,o):n}function v(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function b(t,e){var n=t.className,i=n&&n.baseVal!==y;return e===y?i?n.baseVal:n:(i?n.baseVal=e:t.className=e,void 0)}function x(t){var e;try{return t?"true"==t||("false"==t?!1:"null"==t?null:/^0/.test(t)||isNaN(e=Number(t))?/^[\[\{]/.test(t)?P.parseJSON(t):t:e):t}catch(n){return t}}function w(t,e){e(t);for(var n in t.childNodes)w(t.childNodes[n],e)}var y,k,P,S,M,E,T=[],j=T.slice,O=T.filter,A=window.document,D={},z={},C={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},_=/^\s*<(\w+|!)[^>]*>/,H=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,N=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Y=/^(?:body|html)$/i,X=/([A-Z])/g,I=["val","css","html","text","data","width","height","offset"],L=["after","prepend","before","append"],V=A.createElement("table"),F=A.createElement("tr"),R={tr:A.createElement("tbody"),tbody:V,thead:V,tfoot:V,td:F,th:F,"*":A.createElement("div")},Z=/complete|loaded|interactive/,$=/^[\w-]*$/,B={},U=B.toString,J={},q=A.createElement("div"),W={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},G=Array.isArray||function(t){return t instanceof Array};return J.matches=function(t,e){if(!e||!t||1!==t.nodeType)return!1;var n=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(n)return n.call(t,e);var i,o=t.parentNode,s=!o;return s&&(o=q).appendChild(t),i=~J.qsa(o,e).indexOf(t),s&&q.removeChild(t),i},M=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},E=function(t){return O.call(t,function(e,n){return t.indexOf(e)==n})},J.fragment=function(t,e,n){var i,o,r;return H.test(t)&&(i=P(A.createElement(RegExp.$1))),i||(t.replace&&(t=t.replace(N,"<$1></$2>")),e===y&&(e=_.test(t)&&RegExp.$1),e in R||(e="*"),r=R[e],r.innerHTML=""+t,i=P.each(j.call(r.childNodes),function(){r.removeChild(this)})),s(n)&&(o=P(i),P.each(n,function(t,e){I.indexOf(t)>-1?o[t](e):o.attr(t,e)})),i},J.Z=function(t,e){return t=t||[],t.__proto__=P.fn,t.selector=e||"",t},J.isZ=function(t){return t instanceof J.Z},J.init=function(t,n){var i;if(!t)return J.Z();if("string"==typeof t)if(t=t.trim(),"<"==t[0]&&_.test(t))i=J.fragment(t,RegExp.$1,n),t=null;else{if(n!==y)return P(n).find(t);i=J.qsa(A,t)}else{if(e(t))return P(A).ready(t);if(J.isZ(t))return t;if(G(t))i=a(t);else if(o(t))i=[t],t=null;else if(_.test(t))i=J.fragment(t.trim(),RegExp.$1,n),t=null;else{if(n!==y)return P(n).find(t);i=J.qsa(A,t)}}return J.Z(i,t)},P=function(t,e){return J.init(t,e)},P.extend=function(t){var e,n=j.call(arguments,1);return"boolean"==typeof t&&(e=t,t=n.shift()),n.forEach(function(n){p(t,n,e)}),t},J.qsa=function(t,e){var n,o="#"==e[0],s=!o&&"."==e[0],r=o||s?e.slice(1):e,a=$.test(r);return i(t)&&a&&o?(n=t.getElementById(r))?[n]:[]:1!==t.nodeType&&9!==t.nodeType?[]:j.call(a&&!o?s?t.getElementsByClassName(r):t.getElementsByTagName(e):t.querySelectorAll(e))},P.contains=function(t,e){return t!==e&&t.contains(e)},P.type=t,P.isFunction=e,P.isWindow=n,P.isArray=G,P.isPlainObject=s,P.isEmptyObject=function(t){var e;for(e in t)return!1;return!0},P.inArray=function(t,e,n){return T.indexOf.call(e,t,n)},P.camelCase=M,P.trim=function(t){return null==t?"":String.prototype.trim.call(t)},P.uuid=0,P.support={},P.expr={},P.map=function(t,e){var n,i,o,s=[];if(r(t))for(i=0;i<t.length;i++)n=e(t[i],i),null!=n&&s.push(n);else for(o in t)n=e(t[o],o),null!=n&&s.push(n);return c(s)},P.each=function(t,e){var n,i;if(r(t)){for(n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===!1)return t}else for(i in t)if(e.call(t[i],i,t[i])===!1)return t;return t},P.grep=function(t,e){return O.call(t,e)},window.JSON&&(P.parseJSON=JSON.parse),P.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){B["[object "+e+"]"]=e.toLowerCase()}),P.fn={forEach:T.forEach,reduce:T.reduce,push:T.push,sort:T.sort,indexOf:T.indexOf,concat:T.concat,map:function(t){return P(P.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return P(j.apply(this,arguments))},ready:function(t){return Z.test(A.readyState)&&A.body?t(P):A.addEventListener("DOMContentLoaded",function(){t(P)},!1),this},get:function(t){return t===y?j.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(t){return T.every.call(this,function(e,n){return t.call(e,n,e)!==!1}),this},filter:function(t){return e(t)?this.not(this.not(t)):P(O.call(this,function(e){return J.matches(e,t)}))},add:function(t,e){return P(E(this.concat(P(t,e))))},is:function(t){return this.length>0&&J.matches(this[0],t)},not:function(t){var n=[];if(e(t)&&t.call!==y)this.each(function(e){t.call(this,e)||n.push(this)});else{var i="string"==typeof t?this.filter(t):r(t)&&e(t.item)?j.call(t):P(t);this.forEach(function(t){i.indexOf(t)<0&&n.push(t)})}return P(n)},has:function(t){return this.filter(function(){return o(t)?P.contains(this,t):P(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!o(t)?t:P(t)},last:function(){var t=this[this.length-1];return t&&!o(t)?t:P(t)},find:function(t){var e,n=this;return e="object"==typeof t?P(t).filter(function(){var t=this;return T.some.call(n,function(e){return P.contains(e,t)})}):1==this.length?P(J.qsa(this[0],t)):this.map(function(){return J.qsa(this,t)})},closest:function(t,e){var n=this[0],o=!1;for("object"==typeof t&&(o=P(t));n&&!(o?o.indexOf(n)>=0:J.matches(n,t));)n=n!==e&&!i(n)&&n.parentNode;return P(n)},parents:function(t){for(var e=[],n=this;n.length>0;)n=P.map(n,function(t){return(t=t.parentNode)&&!i(t)&&e.indexOf(t)<0?(e.push(t),t):void 0});return g(e,t)},parent:function(t){return g(E(this.pluck("parentNode")),t)},children:function(t){return g(this.map(function(){return f(this)}),t)},contents:function(){return this.map(function(){return j.call(this.childNodes)})},siblings:function(t){return g(this.map(function(t,e){return O.call(f(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return P.map(this,function(e){return e[t]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=d(this.nodeName))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var n=e(t);if(this[0]&&!n)var i=P(t).get(0),o=i.parentNode||this.length>1;return this.each(function(e){P(this).wrapAll(n?t.call(this,e):o?i.cloneNode(!0):i)})},wrapAll:function(t){if(this[0]){P(this[0]).before(t=P(t));for(var e;(e=t.children()).length;)t=e.first();P(t).append(this)}return this},wrapInner:function(t){var n=e(t);return this.each(function(e){var i=P(this),o=i.contents(),s=n?t.call(this,e):t;o.length?o.wrapAll(s):i.append(s)})},unwrap:function(){return this.parent().each(function(){P(this).replaceWith(P(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var e=P(this);(t===y?"none"==e.css("display"):t)?e.show():e.hide()})},prev:function(t){return P(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return P(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0===arguments.length?this.length>0?this[0].innerHTML:null:this.each(function(e){var n=this.innerHTML;P(this).empty().append(m(this,t,e,n))})},text:function(t){return 0===arguments.length?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t===y?"":""+t})},attr:function(t,e){var n;return"string"==typeof t&&e===y?0==this.length||1!==this[0].nodeType?y:"value"==t&&"INPUT"==this[0].nodeName?this.val():!(n=this[0].getAttribute(t))&&t in this[0]?this[0][t]:n:this.each(function(n){if(1===this.nodeType)if(o(t))for(k in t)v(this,k,t[k]);else v(this,t,m(this,e,n,this.getAttribute(t)))})},removeAttr:function(t){return this.each(function(){1===this.nodeType&&v(this,t)})},prop:function(t,e){return t=W[t]||t,e===y?this[0]&&this[0][t]:this.each(function(n){this[t]=m(this,e,n,this[t])})},data:function(t,e){var n=this.attr("data-"+t.replace(X,"-$1").toLowerCase(),e);return null!==n?x(n):y},val:function(t){return 0===arguments.length?this[0]&&(this[0].multiple?P(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(e){this.value=m(this,t,e,this.value)})},offset:function(t){if(t)return this.each(function(e){var n=P(this),i=m(this,t,e,n.offset()),o=n.offsetParent().offset(),s={top:i.top-o.top,left:i.left-o.left};"static"==n.css("position")&&(s.position="relative"),n.css(s)});if(0==this.length)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(e,n){if(arguments.length<2){var i=this[0],o=getComputedStyle(i,"");if(!i)return;if("string"==typeof e)return i.style[M(e)]||o.getPropertyValue(e);if(G(e)){var s={};return P.each(G(e)?e:[e],function(t,e){s[e]=i.style[M(e)]||o.getPropertyValue(e)}),s}}var r="";if("string"==t(e))n||0===n?r=l(e)+":"+u(e,n):this.each(function(){this.style.removeProperty(l(e))});else for(k in e)e[k]||0===e[k]?r+=l(k)+":"+u(k,e[k])+";":this.each(function(){this.style.removeProperty(l(k))});return this.each(function(){this.style.cssText+=";"+r})},index:function(t){return t?this.indexOf(P(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return t?T.some.call(this,function(t){return this.test(b(t))},h(t)):!1},addClass:function(t){return t?this.each(function(e){S=[];var n=b(this),i=m(this,t,e,n);i.split(/\s+/g).forEach(function(t){P(this).hasClass(t)||S.push(t)},this),S.length&&b(this,n+(n?" ":"")+S.join(" "))}):this},removeClass:function(t){return this.each(function(e){return t===y?b(this,""):(S=b(this),m(this,t,e,S).split(/\s+/g).forEach(function(t){S=S.replace(h(t)," ")}),b(this,S.trim()),void 0)})},toggleClass:function(t,e){return t?this.each(function(n){var i=P(this),o=m(this,t,n,b(this));o.split(/\s+/g).forEach(function(t){(e===y?!i.hasClass(t):e)?i.addClass(t):i.removeClass(t)})}):this},scrollTop:function(t){if(this.length){var e="scrollTop"in this[0];return t===y?e?this[0].scrollTop:this[0].pageYOffset:this.each(e?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})}},scrollLeft:function(t){if(this.length){var e="scrollLeft"in this[0];return t===y?e?this[0].scrollLeft:this[0].pageXOffset:this.each(e?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})}},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),n=this.offset(),i=Y.test(e[0].nodeName)?{top:0,left:0}:e.offset();return n.top-=parseFloat(P(t).css("margin-top"))||0,n.left-=parseFloat(P(t).css("margin-left"))||0,i.top+=parseFloat(P(e[0]).css("border-top-width"))||0,i.left+=parseFloat(P(e[0]).css("border-left-width"))||0,{top:n.top-i.top,left:n.left-i.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||A.body;t&&!Y.test(t.nodeName)&&"static"==P(t).css("position");)t=t.offsetParent;return t})}},P.fn.detach=P.fn.remove,["width","height"].forEach(function(t){var e=t.replace(/./,function(t){return t[0].toUpperCase()});P.fn[t]=function(o){var s,r=this[0];return o===y?n(r)?r["inner"+e]:i(r)?r.documentElement["scroll"+e]:(s=this.offset())&&s[t]:this.each(function(e){r=P(this),r.css(t,m(this,o,e,r[t]()))})}}),L.forEach(function(e,n){var i=n%2;P.fn[e]=function(){var e,o,s=P.map(arguments,function(n){return e=t(n),"object"==e||"array"==e||null==n?n:J.fragment(n)}),r=this.length>1;return s.length<1?this:this.each(function(t,e){o=i?e:e.parentNode,e=0==n?e.nextSibling:1==n?e.firstChild:2==n?e:null,s.forEach(function(t){if(r)t=t.cloneNode(!0);else if(!o)return P(t).remove();w(o.insertBefore(t,e),function(t){null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML)})})})},P.fn[i?e+"To":"insert"+(n?"Before":"After")]=function(t){return P(t)[e](this),this}}),J.Z.prototype=P.fn,J.uniq=E,J.deserializeValue=x,P.zepto=J,P}();window.Zepto=n,void 0===window.$&&(window.$=n),e.exports=n}),define("lib/core/zepto/event",function(require){function t(t){return t._zid||(t._zid=d++)}function e(e,o,s,r){if(o=n(o),o.ns)var a=i(o.ns);return(m[t(e)]||[]).filter(function(e){return!(!e||o.e&&e.e!=o.e||o.ns&&!a.test(e.ns)||s&&t(e.fn)!==t(s)||r&&e.sel!=r)})}function n(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function i(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function o(t,e){return t.del&&!b&&t.e in x||!!e}function s(t){return w[t]||b&&x[t]||t}function r(e,i,r,a,l,d,f){var p=t(e),g=m[p]||(m[p]=[]);i.split(/\s/).forEach(function(t){if("ready"==t)return u(document).ready(r);var i=n(t);i.fn=r,i.sel=l,i.e in w&&(r=function(t){var e=t.relatedTarget;return!e||e!==this&&!u.contains(this,e)?i.fn.apply(this,arguments):void 0}),i.del=d;var p=d||r;i.proxy=function(t){if(t=c(t),!t.isImmediatePropagationStopped()){t.data=a;var n=p.apply(e,t._args==h?[t]:[t].concat(t._args));return n===!1&&(t.preventDefault(),t.stopPropagation()),n}},i.i=g.length,g.push(i),"addEventListener"in e&&e.addEventListener(s(i.e),i.proxy,o(i,f))})}function a(n,i,r,a,c){var l=t(n);(i||"").split(/\s/).forEach(function(t){e(n,t,r,a).forEach(function(t){delete m[l][t.i],"removeEventListener"in n&&n.removeEventListener(s(t.e),t.proxy,o(t,c))})})}function c(t,e){return(e||!t.isDefaultPrevented)&&(e||(e=t),u.each(S,function(n,i){var o=e[n];t[n]=function(){return this[i]=y,o&&o.apply(e,arguments)},t[i]=k}),(e.defaultPrevented!==h?e.defaultPrevented:"returnValue"in e?e.returnValue===!1:e.getPreventDefault&&e.getPreventDefault())&&(t.isDefaultPrevented=y)),t}function l(t){var e,n={originalEvent:t};for(e in t)P.test(e)||t[e]===h||(n[e]=t[e]);return c(n,t)}var h,u=require("lib/core/zepto/zepto"),d=1,f=Array.prototype.slice,p=u.isFunction,g=function(t){return"string"==typeof t},m={},v={},b="onfocusin"in window,x={focus:"focusin",blur:"focusout"},w={mouseenter:"mouseover",mouseleave:"mouseout"};v.click=v.mousedown=v.mouseup=v.mousemove="MouseEvents",u.event={add:r,remove:a},u.proxy=function(e,n){if(p(e)){var i=function(){return e.apply(n,arguments)};return i._zid=t(e),i}if(g(n))return u.proxy(e[n],e);throw new TypeError("expected function")},u.fn.bind=function(t,e,n){return this.on(t,e,n)},u.fn.unbind=function(t,e){return this.off(t,e)},u.fn.one=function(t,e,n,i){return this.on(t,e,n,i,1)};var y=function(){return!0},k=function(){return!1},P=/^([A-Z]|returnValue$|layer[XY]$)/,S={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};u.fn.delegate=function(t,e,n){return this.on(e,t,n)},u.fn.undelegate=function(t,e,n){return this.off(e,t,n)},u.fn.live=function(t,e){return u(document.body).delegate(this.selector,t,e),this},u.fn.die=function(t,e){return u(document.body).undelegate(this.selector,t,e),this},u.fn.on=function(t,e,n,i,o){var s,c,d=this;return t&&!g(t)?(u.each(t,function(t,i){d.on(t,e,n,i,o)}),d):(g(e)||p(i)||i===!1||(i=n,n=e,e=h),(p(n)||n===!1)&&(i=n,n=h),i===!1&&(i=k),d.each(function(h,d){o&&(s=function(t){return a(d,t.type,i),i.apply(this,arguments)}),e&&(c=function(t){var n,o=u(t.target).closest(e,d).get(0);return o&&o!==d?(n=u.extend(l(t),{currentTarget:o,liveFired:d}),(s||i).apply(o,[n].concat(f.call(arguments,1)))):void 0}),r(d,t,i,n,e,c||s)}))},u.fn.off=function(t,e,n){var i=this;return t&&!g(t)?(u.each(t,function(t,n){i.off(t,e,n)}),i):(g(e)||p(n)||n===!1||(n=e,e=h),n===!1&&(n=k),i.each(function(){a(this,t,n,e)}))},u.fn.trigger=function(t,e){return t=g(t)||u.isPlainObject(t)?u.Event(t):c(t),t._args=e,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(t):u(this).triggerHandler(t,e)})},u.fn.triggerHandler=function(t,n){var i,o;return this.each(function(s,r){i=l(g(t)?u.Event(t):t),i._args=n,i.target=r,u.each(e(r,t.type||t),function(t,e){return o=e.proxy(i),i.isImmediatePropagationStopped()?!1:void 0})}),o},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){u.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}}),["focus","blur"].forEach(function(t){u.fn[t]=function(e){return e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}}),this}}),u.Event=function(t,e){g(t)||(e=t,t=e.type);var n=document.createEvent(v[t]||"Events"),i=!0;if(e)for(var o in e)"bubbles"==o?i=!!e[o]:n[o]=e[o];return n.initEvent(t,i,!0),c(n)}}),define("lib/core/zepto/touch",function(require){function t(t,e,n,i){return Math.abs(t-e)>=Math.abs(n-i)?t-e>0?"Left":"Right":n-i>0?"Up":"Down"}function e(){l=null,d.last&&(d.el.trigger("longTap"),d={})}function n(){l&&clearTimeout(l),l=null}function i(){r&&clearTimeout(r),a&&clearTimeout(a),c&&clearTimeout(c),l&&clearTimeout(l),r=a=c=l=null,d={}}function o(t){return("touch"==t.pointerType||t.pointerType==t.MSPOINTER_TYPE_TOUCH)&&t.isPrimary}function s(t,e){return t.type=="pointer"+e||t.type.toLowerCase()=="mspointer"+e}var r,a,c,l,h,u=require("lib/core/zepto/zepto"),d={},f=750;u(document).ready(function(){var p,g,m,v,b=0,x=0;"MSGesture"in window&&(h=new MSGesture,h.target=document.body),u(document).bind("MSGestureEnd",function(t){var e=t.velocityX>1?"Right":t.velocityX<-1?"Left":t.velocityY>1?"Down":t.velocityY<-1?"Up":null;e&&(d.el.trigger("swipe"),d.el.trigger("swipe"+e))}).on("touchstart MSPointerDown pointerdown",function(t){b=x=0,(!(v=s(t,"down"))||o(t))&&(m=v?t:t.touches[0],t.touches&&1===t.touches.length&&d.x2&&(d.x2=void 0,d.y2=void 0),p=Date.now(),g=p-(d.last||p),d.el=u("tagName"in m.target?m.target:m.target.parentNode),r&&clearTimeout(r),d.x1=m.pageX,d.y1=m.pageY,g>0&&250>=g&&(d.isDoubleTap=!0),d.last=p,l=setTimeout(e,f),h&&v&&h.addPointer(t.pointerId))}).on("touchmove MSPointerMove pointermove",function(t){(!(v=s(t,"move"))||o(t))&&(m=v?t:t.touches[0],n(),d.x2=m.pageX,d.y2=m.pageY,b+=Math.abs(d.x1-d.x2),x+=Math.abs(d.y1-d.y2))}).on("touchend MSPointerUp pointerup",function(e){(!(v=s(e,"up"))||o(e))&&(n(),d.x2&&Math.abs(d.x1-d.x2)>30||d.y2&&Math.abs(d.y1-d.y2)>30?c=setTimeout(function(){d.el.trigger("swipe"),d.el.trigger("swipe"+t(d.x1,d.x2,d.y1,d.y2)),d={}},0):"last"in d&&(30>b&&30>x?a=setTimeout(function(){var t=u.Event("tap");t.cancelTouch=i,d.el.trigger(t),d.isDoubleTap?(d.el&&d.el.trigger("doubleTap"),d={}):r=setTimeout(function(){r=null,d.el&&d.el.trigger("singleTap"),d={}},250)},0):d={}),b=x=0)}).on("touchcancel MSPointerCancel pointercancel",i),u(window).on("scroll",i)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){u.fn[t]=function(e){return this.on(t,e)}})}),define("lib/core/zepto/ajax",function(require){function t(t,e,n){var i=m.Event(e);return m(t).trigger(i,n),!i.isDefaultPrevented()}function e(e,n,i,o){return e.global?t(n||b,i,o):void 0}function n(t){t.global&&0===m.active++&&e(t,null,"ajaxStart")}function i(t){t.global&&!--m.active&&e(t,null,"ajaxStop")}function o(t,n){var i=n.context;return n.beforeSend.call(i,t,n)===!1||e(n,i,"ajaxBeforeSend",[t,n])===!1?!1:(e(n,i,"ajaxSend",[t,n]),void 0)}function s(t,n,i,o){var s=i.context,r="success";i.success.call(s,t,r,n),o&&o.resolveWith(s,[t,r,n]),e(i,s,"ajaxSuccess",[n,i,t]),a(r,n,i)}function r(t,n,i,o,s){var r=o.context;o.error.call(r,i,n,t),s&&s.rejectWith(r,[i,n,t]),e(o,r,"ajaxError",[i,o,t||n]),a(n,i,o)}function a(t,n,o){var s=o.context;o.complete.call(s,n,t),e(o,s,"ajaxComplete",[n,o]),i(o)}function c(){}function l(t){return t&&(t=t.split(";",2)[0]),t&&(t==P?"html":t==k?"json":w.test(t)?"script":y.test(t)&&"xml")||"text"}function h(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function u(t){t.processData&&t.data&&"string"!=m.type(t.data)&&(t.data=m.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=h(t.url,t.data),t.data=void 0)}function d(t,e,n,i){return m.isFunction(e)&&(i=n,n=e,e=void 0),m.isFunction(n)||(i=n,n=void 0),{url:t,data:e,success:n,dataType:i}}function f(t,e,n,i){var o,s=m.isArray(e),r=m.isPlainObject(e);m.each(e,function(e,a){o=m.type(a),i&&(e=n?i:i+"["+(r||"object"==o||"array"==o?e:"")+"]"),!i&&s?t.add(a.name,a.value):"array"==o||!n&&"object"==o?f(t,a,n,e):t.add(e,a)})}var p,g,m=require("lib/core/zepto/zepto"),v=0,b=window.document,x=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,w=/^(?:text|application)\/javascript/i,y=/^(?:text|application)\/xml/i,k="application/json",P="text/html",S=/^\s*$/;m.active=0,m.ajaxJSONP=function(t,e){if(!("type"in t))return m.ajax(t);var n,i,a=t.jsonpCallback,c=(m.isFunction(a)?a():a)||"jsonp"+ ++v,l=b.createElement("script"),h=window[c],u=function(t){m(l).triggerHandler("error",t||"abort")},d={abort:u};return e&&e.promise(d),m(l).on("load error",function(o,a){clearTimeout(i),m(l).off().remove(),"error"!=o.type&&n?s(n[0],d,t,e):r(null,a||"error",d,t,e),window[c]=h,n&&m.isFunction(h)&&h(n[0]),h=n=void 0}),o(d,t)===!1?(u("abort"),d):(window[c]=function(){n=arguments},l.src=t.url.replace(/\?(.+)=\?/,"?$1="+c),b.head.appendChild(l),t.timeout>0&&(i=setTimeout(function(){u("timeout")},t.timeout)),d)},m.ajaxSettings={type:"GET",beforeSend:c,success:c,error:c,complete:c,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:k,xml:"application/xml, text/xml",html:P,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},m.ajax=function(t){var e=m.extend({},t||{}),i=m.Deferred&&m.Deferred();for(p in m.ajaxSettings)void 0===e[p]&&(e[p]=m.ajaxSettings[p]);n(e),e.crossDomain||(e.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(e.url)&&RegExp.$2!=window.location.host),e.url||(e.url=window.location.toString()),u(e),e.cache===!1&&(e.url=h(e.url,"_="+Date.now()));var a=e.dataType,d=/\?.+=\?/.test(e.url);if("jsonp"==a||d)return d||(e.url=h(e.url,e.jsonp?e.jsonp+"=?":e.jsonp===!1?"":"callback=?")),m.ajaxJSONP(e,i);var f,v=e.accepts[a],b={},x=function(t,e){b[t.toLowerCase()]=[t,e]},w=/^([\w-]+:)\/\//.test(e.url)?RegExp.$1:window.location.protocol,y=e.xhr(),k=y.setRequestHeader;if(i&&i.promise(y),e.crossDomain||x("X-Requested-With","XMLHttpRequest"),x("Accept",v||"*/*"),(v=e.mimeType||v)&&(v.indexOf(",")>-1&&(v=v.split(",",2)[0]),y.overrideMimeType&&y.overrideMimeType(v)),(e.contentType||e.contentType!==!1&&e.data&&"GET"!=e.type.toUpperCase())&&x("Content-Type",e.contentType||"application/x-www-form-urlencoded"),e.headers)for(g in e.headers)x(g,e.headers[g]);if(y.setRequestHeader=x,y.onreadystatechange=function(){if(4==y.readyState){y.onreadystatechange=c,clearTimeout(f);var t,n=!1;if(y.status>=200&&y.status<300||304==y.status||0==y.status&&"file:"==w){a=a||l(e.mimeType||y.getResponseHeader("content-type")),t=y.responseText;try{"script"==a?(1,eval)(t):"xml"==a?t=y.responseXML:"json"==a&&(t=S.test(t)?null:m.parseJSON(t))}catch(o){n=o}n?r(n,"parsererror",y,e,i):s(t,y,e,i)}else r(y.statusText||null,y.status?"error":"abort",y,e,i)
}},o(y,e)===!1)return y.abort(),r(null,"abort",y,e,i),y;if(e.xhrFields)for(g in e.xhrFields)y[g]=e.xhrFields[g];var P="async"in e?e.async:!0;y.open(e.type,e.url,P,e.username,e.password);for(g in b)k.apply(y,b[g]);return e.timeout>0&&(f=setTimeout(function(){y.onreadystatechange=c,y.abort(),r(null,"timeout",y,e,i)},e.timeout)),y.send(e.data?e.data:null),y},m.get=function(){return m.ajax(d.apply(null,arguments))},m.post=function(){var t=d.apply(null,arguments);return t.type="POST",m.ajax(t)},m.getJSON=function(){var t=d.apply(null,arguments);return t.dataType="json",m.ajax(t)},m.fn.load=function(t,e,n){if(!this.length)return this;var i,o=this,s=t.split(/\s/),r=d(t,e,n),a=r.success;return s.length>1&&(r.url=s[0],i=s[1]),r.success=function(t){o.html(i?m("<div>").html(t.replace(x,"")).find(i):t),a&&a.apply(o,arguments)},m.ajax(r),this};var M=encodeURIComponent;m.param=function(t,e){var n=[];return n.add=function(t,e){this.push(M(t)+"="+M(e))},f(n,t,e),n.join("&").replace(/%20/g,"+")}}),define("lib/core/extra/zepto/zepto",function(require){var t=require("lib/core/zepto/zepto"),e=window.console,n=e&&"function"==typeof e.log;t.extend(t,{noop:function(){},log:function(){n&&e.log.apply(e,arguments)},hyphenate:function(t){return t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()})}}),t.extend(t.fn,{occurInside:function(t){return this.length&&t&&t.target?this[0]===t.target||this.has(t.target).length:void 0},hasAttr:function(t){return this[0]&&this[0].hasAttribute(t)},reflow:function(){this.size()&&this.get(0).clientLeft;return this}})}),define("lib/core/extra/zepto/prefixfree",function(require){var t=require("lib/core/zepto/zepto");require("lib/core/extra/zepto/zepto");var e,n=t.camelCase,i=t.hyphenate;!function(t){function o(t,e){-1===t.indexOf(e)&&t.push(e)}if(window.getComputedStyle){var s=window.getComputedStyle,r={prefixProperty:function(t,e){var i=r.prefix+t;return e?n(i):i}};e=r,function(){var t,e,a={},c={prefix:"",uses:0},l=[],h=s(document.documentElement,null),u=document.createElement("div").style,d=function(t){if(o(l,t),t.indexOf("-")>-1){var e=t.split("-");if("-"===t.charAt(0)){var i=e[1],s=++a[i]||1;for(a[i]=s,c.uses<s&&(c={prefix:i,uses:s});e.length>3;){e.pop();var r=e.join("-"),h=n(r);h in u&&o(l,r)}}}};if(h.length>0)for(t=0;t<h.length;t++)d(h[t]);else for(e in h)d(i(e));for(r.prefix="-"+c.prefix+"-",r.Prefix=n(r.prefix),l.sort(),r.properties=[],t=0;t<l.length&&(e=l[t],"-"===e.charAt(0));t++)if(0===e.indexOf(r.prefix)){var f=e.slice(r.prefix.length);n(f)in u||r.properties.push(f)}"Ms"!=r.Prefix||"transform"in u||"MsTransform"in u||!("msTransform"in u)||r.properties.push("transform","transform-origin"),r.properties.sort()}(),t.className+=" "+r.prefix}}(document.documentElement),function(){if(e){var i=e;t.cssProps=t.cssProps||{};var o,s,r,a;for(o=0;o<i.properties.length;o++)s=i.properties[o],r=n(s),a=i.prefixProperty(s),t.cssProps[r]=a;var c=t.fn.css,l=function(e){return e?e=e.replace(/transform/gi,t.cssProps.transform):e};t.fn.css=function(e,i){var o,s,r;if("string"==typeof e)r=n(e),t.cssProps[r]&&(e=t.cssProps[r],i=l(i));else for(o in e)r=n(o),t.cssProps[r]&&(s=t.cssProps[r],e[s]=l(e[o]),delete e[o]);return arguments.length<2?c.apply(this,[e]):c.apply(this,[e,i])},t.getPrefix=function(){return e.prefix}}}()}),define("lib/core/extra/zepto/transform",function(require){var t=require("lib/core/zepto/zepto");t.fn.transform=function(e,n){var i={},o=t(this).css("transform")||"";if(o="none"===o?"":o,o=o.replace(/,\s+/gi,","),t.each(o.split(/\s+/gi),function(e,n){if(n){var o=n.match(/\w+/)[0],s=n.replace(o,"").replace(/[\(\)]/gi,"");s=t.trim(s),i[o]=s}}),!e)return i;if("string"==typeof e){if("undefined"===t.type(n))return i[e]||0;i[e]=n}else t.extend(i,e);return o=[],t.each(i,function(t,e){var n=t+"("+e+")";o.push(n)}),o=o.length?o.join(" "):"",t(this).css("transform",o)}}),define("lib/core/extra/zepto/transit",function(require){function t(t){return t.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase()}function e(t){return n?n+t:t.toLowerCase()}var n,i,o,s,r,a,c,l,h,u,d=require("lib/core/zepto/zepto"),f="",p={Webkit:"webkit",Moz:"",O:"o"},g=window.document,m=g.createElement("div"),v=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,b={};d.each(p,function(t,e){return void 0!==m.style[t+"TransitionProperty"]?(f="-"+t.toLowerCase()+"-",n=e,!1):void 0}),i="transform",b[o="transition-property"]=b[s="transition-duration"]=b[a="transition-delay"]=b[r="transition-timing-function"]=b[c="animation-name"]=b[l="animation-duration"]=b[u="animation-delay"]=b[h="animation-timing-function"]="",d.fx={off:void 0===n&&void 0===m.style.transitionProperty,speeds:{_default:400,fast:200,slow:600},cssPrefix:f,transitionEnd:e("TransitionEnd"),animationEnd:e("AnimationEnd")},d.fn.transit=function(t,e,n,i,o){return d.isFunction(e)&&(i=e,n=void 0,e=void 0),d.isFunction(n)&&(i=n,n=void 0),d.isPlainObject(e)&&(n=e.easing,i=e.complete,o=e.delay,e=e.duration),e&&(e=("number"==typeof e?e:d.fx.speeds[e]||d.fx.speeds._default)/1e3),o&&(o=parseFloat(o)/1e3),this.anim(t,e,n,i,o)},d.fn.anim=function(e,n,f,p,g){var m,x,w,y={},k="",P=this,S=d.fx.transitionEnd,M=!1;if(void 0===n&&(n=d.fx.speeds._default/1e3),void 0===g&&(g=0),d.fx.off&&(n=0),"string"==typeof e)y[c]=e,y[l]=n+"s",y[u]=g+"s",y[h]=f||"linear",S=d.fx.animationEnd;else{x=[];for(m in e)v.test(m)?k+=m+"("+e[m]+") ":(y[m]=e[m],x.push(t(m)));k&&(y[i]=k,x.push(i)),n>0&&"object"==typeof e&&(y[o]="*",y[s]=n+"s",y[a]=g+"s",y[r]=f||"linear")}w=function(t){if("undefined"!=typeof t){if(t.target!==t.currentTarget)return;d(t.target).unbind(S,w)}else d(this).unbind(S,w);M=!0,d(this).css(b),p&&p.call(this)},n>0&&(this.bind(S,w),setTimeout(function(){M||w.call(P)},1e3*n+25));this.size()&&this.get(0).clientLeft;return this.css(y),0>=n&&setTimeout(function(){P.each(function(){w.call(this)})},0),this},m=null}),define("lib/mvc/view",function(require,t,e){var n=require("lib"),i=require("lib/mvc/base"),o=require("lib/mvc/delegate"),s=function(){var t=this.conf,e=t.template,i=this.nodes,o=i.root;return o||(t.node&&(o=n(t.node)),o&&o.length||(n.isArray(e)&&(e=e.join("")),o=n(e)),i.root=o),o},r=i.extend({defaults:{node:"",template:"",events:{},role:{}},initialize:function(){this.nodes={},r.superclass.initialize.apply(this,arguments)},setEvents:function(t){this.delegate(t)},delegate:function(t,e,n,i){t=t||"on",e=e||this.role("root"),n=n||this.conf.events,i=i||this,o(t,e,n,i)},role:function(t,e){var i=this.nodes,o=s.call(this),r=this.conf.role||{};return e?i[t]=e=n(e):(i[t]&&(e=i[t]),"root"===t?e=o:e&&e.length||(e=r[t]?o.find(r[t]):o.find('[data-role="'+t+'"]'),i[t]=e)),e},resetRoles:function(){var t=this.nodes;n.each(t,function(e){"root"!==e&&(t[e]=null,delete t[e])})},destroy:function(){r.superclass.destroy.apply(this,arguments),this.resetRoles(),this.nodes=null}});e.exports=r}),define("lib/kit/util/template",function(require,t,e){var n=require("lib");e.exports=function(t){var e={},i={};return i.set=function(t){n.extend(i,t),n.extend(e,t)},i.get=function(t){var n="",i=e[t];return i&&("string"==typeof i?n=i:Array.isArray(i)&&(e[t]=n=i.join(""))),n},i.set(t),i}}),define("mods/model/scene",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=n.extend({defaults:{type:"front",perspective:200,perspectiveOrigin:"50% 50%"},events:{"change:type":"compute"},build:function(){this.compute()},compute:function(){var t=this.get("type");"left"===t?this.set("perspectiveOrigin","50% 45%"):"right"===t?this.set("perspectiveOrigin","50% 55%"):this.set("perspectiveOrigin","50% 50%")}});e.exports=i}),define("mods/view/coordinateSystem",function(require,t,e){var n=(require("lib"),require("lib/mvc/view")),i=require("lib/kit/util/template"),o=require("mods/model/coordinateSystem"),s=require("mods/util/computeOrientationToTransform"),r=require("mods/channel/socket"),a=i({box:['<div class="coordinate-system">','<div class="box-cs"  data-role="axis-box">','<div class="axis ax">','<div class="direction"></div>',"</div>",'<div class="axis ay">','<div class="direction"></div>',"</div>",'<div class="axis az">','<div class="direction"></div>',"</div>","</div>","</div>"]}),c=null,l=n.extend({defaults:{name:"coordinate",path:"",isSightDevice:!0,showAxis:!1,template:a.box,personModel:null,parent:null},build:function(){var t=this.conf;this.path=[t.path,t.name].join("."),this.model=new o({showAxis:t.showAxis}),this.personModel=t.personModel,this.insert(),this.setStyles(),this.checkAxis(),t.isSightDevice&&!c&&(c=this),setTimeout(function(){this.compute({alpha:0,beta:89,gamma:0})}.bind(this))},insert:function(){this.role("root").appendTo(this.conf.parent)},setEvents:function(t){var e=this.proxy(),n=this.model;this.delegate(t),this.conf.isSightDevice?window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",e("compute")):r.on("deviceorientation",e("sync")),n.on("change:transform",e("setCoordinateSystem"))},compute:function(t){var e=s(t),n={alpha:t.alpha,beta:t.beta,gamma:t.gamma,transform:e};c===this&&r.trigger("deviceorientation",n),this.sync(n)},sync:function(t){this.model.set("transform",t.transform),this.personModel.set({alpha:t.alpha,beta:t.beta,gamma:t.gamma})},setStyles:function(){},setCoordinateSystem:function(){var t=this.model,e=t.get("transform");this.role("root").css("transform",e)},toggleAxis:function(){var t=this.model;t.set(!t.get("showAxis"))},checkAxis:function(){var t=this.role("axis-box");this.model.get("showAxis")?t.show():t.hide()},update:function(t){this.model.set(t)},toJSON:function(){return this.model.get()}});e.exports=l}),define("mods/view/house",function(require,t,e){var n=(require("lib"),require("lib/mvc/view")),i=require("mods/view/room"),o=n.extend({defaults:{name:"house",path:"",env:null,personModel:null,coordinateSystem:null},build:function(){var t=this.conf;this.path=[t.path,t.name].join("."),this.env=t.env,this.personModel=this.conf.personModel,this.coordinateSystem=this.conf.coordinateSystem,this.buildRooms()},buildRooms:function(){this.room=new i({path:this.path,env:this.env,personModel:this.personModel,coordinateSystem:this.coordinateSystem})},update:function(t){t=t||{},this.room.update(t.room)},toJSON:function(){var t={};return t.room=this.room.toJSON(),t}});e.exports=o}),define("mods/model/person",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=n.extend({defaults:{alpha:0,beta:0,gamma:0,posture:"standing",padHeight:.7,eyeHeight:1.1,groundX:0,groundY:0},events:{"posture:change":"checkPosture"},build:function(){this.checkPosture()},checkPosture:function(){var t=this.get("posture");"standing"===t?this.set({padHeight:1.1,eyeHeight:1.6}):this.set({padHeight:.7,eyeHeight:1.1})},toJSON:function(){return this.get()}});e.exports=i}),define("mods/ctrl/env",function(require,t,e){var n=require("lib/mvc/controller"),i=require("mods/channel/socket"),o=require("mods/view/backgroundSelector"),s=n.extend({defaults:{scene:null},build:function(){var t=this.conf;this.scene=t.scene},setEvents:function(){var t=this.proxy();i.on("toggle-bg-selector",t("toggleBgSelector"))},getRatio:function(){return 200},getObjByPath:function(t){return this.scene.getObjByPath(t)},toggleBgSelector:function(t){this.bgSelector||(this.bgSelector=new o({env:this})),this.bgSelector.toggle(t)}});e.exports=s}),define("mods/ctrl/preload",function(require,t,e){var n=(require("lib"),require("lib/mvc/controller")),i=["wallpaper/wp1.jpg","icon/icon1.png","icon/icon2.png","icon/icon3.png","icon/icon4.png","icon/icon5.png","icon/icon6.png","icon/icon7.png","icon/icon8.png","icon/icon9.png"],o=n.extend({getCount:function(){return i.length},start:function(){var t=this;if(!this.started){this.started=!0;var e=i.length;this.trigger("start",e);var n=0;i.forEach(function(i){var o=new Image;i="images/"+i;var s=function(){n++,t.trigger("step",n,e),n>=e&&t.trigger("complete")};o.onload=s,o.onerror=s,o.src=i})}}});e.exports=new o}),define("mods/model/touchPad",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=n.extend({defaults:{lockAlpha:!1,eyeHeight:0,alpha:0,beta:0,gamma:0},events:{},build:function(){}});e.exports=new i}),define("lib/more/events",function(require,t,e){function n(){}var i=/\s+/;n.prototype.on=function(t,e,n){var o,s,r;if(!e)return this;for(o=this.__events||(this.__events={}),t=t.split(i);s=t.shift();)r=o[s]||(o[s]=[]),r.push(e,n);return this},n.prototype.off=function(t,e,n){var s,r,a,c;if(!(s=this.__events))return this;if(!(t||e||n))return delete this.__events,this;for(t=t?t.split(i):o(s);r=t.shift();)if(a=s[r])if(e||n)for(c=a.length-2;c>=0;c-=2)e&&a[c]!==e||n&&a[c+1]!==n||a.splice(c,2);else delete s[r];return this},n.prototype.trigger=function(t){var e,n,o,s,r,a,c,l=[];if(!(e=this.__events))return this;for(t=t.split(i),r=1,a=arguments.length;a>r;r++)l[r-1]=arguments[r];for(;n=t.shift();){if((o=e.all)&&(o=o.slice()),(s=e[n])&&(s=s.slice()),s)for(r=0,a=s.length;a>r;r+=2)s[r].apply(s[r+1]||this,l);if(o)for(c=[n].concat(l),r=0,a=o.length;a>r;r+=2)o[r].apply(o[r+1]||this,c)}return this},n.mixTo=function(t){t=t.prototype||t;var e=n.prototype;for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};var o=Object.keys;o||(o=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}),e.exports=n}),define("mods/socket/client",function(require,t,e){var n=function(){this.iourl=window.location.host};n.prototype={constructor:n,init:function(t){this.vrhd=io(this.iourl),this.set(t)},set:function(t){this.vrhd.emit("set",t)},on:function(t,e){this.vrhd.on(t,e)}},e.exports=new n}),define("lib/kit/util/timer",function(require,t,e){var n=require("lib"),i=window,o=n.getPrefix().replace(/-/gi,""),s=function(t){var e=t.charAt(0).toUpperCase()+t.substr(1),s=i[t]||i[o+e];return"function"===n.type(s)?s.bind(i):null},r=s("requestAnimationFrame"),a=s("cancelAnimationFrame")||n.noop,c={};if(r){var l=function(t,e,n){var i={},o=Date.now();return e=e||0,e=Math.max(e,0),i.step=function(){var s=Date.now();s-o>e&&(t(),"timeout"===n?h(i):o=s),i.requestId=r(i.step)},r(i.step),i},h=function(t){t.requestId&&"function"===n.type(t.step)&&(t.step=n.noop,a(t.requestId),t.requestId=0)};c.setInterval=function(t,e){return l(t,e,"interval")},c.setTimeout=function(t,e){return l(t,e,"timeout")},c.clearTimeout=h,c.clearInterval=h}c.setInterval=c.setInterval||i.setInterval.bind(i),c.clearInterval=c.clearInterval||i.clearInterval.bind(i),c.setTimeout=c.setTimeout||i.setTimeout.bind(i),c.clearTimeout=c.clearTimeout||i.clearTimeout.bind(i),e.exports=c}),define("lib/mvc/base",function(require,t,e){var n=require("lib"),i=require("lib/more/class"),o=require("lib/more/events"),s=i.create({Implements:[o],defaults:{},initialize:function(t){this.setOptions(t),this.build(),this.setEvents("on")},setOptions:function(t){this.conf=this.conf||n.extend(!0,{},this.defaults),n.isPlainObject(t)||(t={}),n.extend(!0,this.conf,t)},build:n.noop,setEvents:n.noop,proxy:function(t){var e=this,i=this.bound?this.bound:this.bound={};return t=t||"proxy",n.isFunction(i[t])||(i[t]=function(){return n.isFunction(e[t])?e[t].apply(e,arguments):void 0}),i[t]},destroy:function(){this.setEvents("off"),this.off(),this.bound=null}});e.exports=s}),define("lib/mvc/delegate",function(require,t,e){e.exports=function(t,e,n,i){var o,s;e&&i&&$.isFunction(i.proxy)&&(o=i.proxy(),t="on"===t?"on":"off",s="on"===t?"delegate":"undelegate",n=$.extend({},n),$.each(n,function(n,i){var r,a,c=[];if(n=n.split(/\s+/),"string"===$.type(i))c=i.split(/\s+/).map(function(t){return o(t)});else{if(!$.isFunction(i))return;c=[i]}a=n.pop(),n.length>=1?(r=n.join(" "),$.isFunction(e[s])&&c.forEach(function(t){e[s](r,a,t)})):$.isFunction(e[t])&&c.forEach(function(n){e[t](a,n)})}))}}),define("lib/mvc/model",function(require,t,e){var n=require("lib"),i=require("lib/mvc/base"),o=require("lib/mvc/delegate"),s="__private__",r=function(t,e){if("string"===n.type(t)){var i=this,o=this.data||{};o.hasOwnProperty(s)||(Object.defineProperty(o,s,{writable:!0,enumerable:!1,configurable:!0}),o[s]={}),o.hasOwnProperty(t)||(Object.defineProperty(o,t,{set:function(e){var n=this[t];e!==n&&(this[s][t]=e,i.changed=!0,i.trigger("change:"+t,n))},get:function(){return this[s][t]},enumerable:!0,configurable:!0}),this.changed=!0),o[t]=e}},a=function(t,e){if("string"===n.type(t)){var i=this,o=this.data||{};r.call(this,t),Object.defineProperty(o,t,{get:function(){return e.call(i,this[s][t])}})}},c=function(t){delete this.data[t]},l=i.extend({defaults:{},events:{},initialize:function(){this.data={},this.changed=!1,l.superclass.initialize.apply(this,arguments)},setOptions:function(){l.superclass.setOptions.apply(this,arguments),this.set(this.conf)},setEvents:function(t){this.delegate(t)},delegate:function(t,e,n,i){t=t||"on",e=e||this,n=n||this.events,i=i||this,o(t,e,n,i)},set:function(t,e){n.isPlainObject(t)?n.each(t,r.bind(this)):"string"===n.type(t)&&r.call(this,t,e),this.changed&&(this.trigger("change"),this.changed=!1)},get:function(t){var e;return"string"===n.type(t)?(e=this.data[t],n.isPlainObject(e)?n.extend(!0,{},e):n.isArray(e)?n.extend(!0,[],e):e):"undefined"==typeof t?n.extend(!0,{},this.data):void 0},setComputed:function(t,e){"object"===n.type(t)?n.each(t,a.bind(this)):"string"===n.type(t)&&n.isFunction(e)&&a.call(this,t,e)},keys:function(){return Object.keys(this.data)},remove:function(t){c.call(this,t),this.trigger("change:"+t),this.trigger("change")},clear:function(){Object.keys(this.data).forEach(this.remove,this)},destroy:function(){this.changed=!1,l.superclass.destroy.apply(this,arguments),this.clear(),this.data=null}});e.exports=l}),define("mods/model/coordinateSystem",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=n.extend({defaults:{transform:""},events:{},build:function(){}});e.exports=i}),define("mods/util/computeOrientationToTransform",function(require,t,e){function n(t,e,n){var i=e?e*l:0,o=n?n*l:0,s=t?t*l:0,r=Math.cos(i),a=Math.cos(o),c=Math.cos(s),h=Math.sin(i),u=Math.sin(o),d=Math.sin(s),f=c*a-d*h*u,p=-r*d,g=a*d*h+c*u,m=a*d+c*h*u,v=c*r,b=d*u-c*a*h,x=-r*u,w=h,y=r*a;return[f,p,g,m,v,b,x,w,y]}function i(t){var e=t?t*l:0,n=Math.cos(e),i=Math.sin(e),o=[n,-i,0,i,n,0,0,0,1];return o}function o(){var t=90*l,e=Math.cos(t),n=Math.sin(t),i=[1,0,0,0,e,-n,0,n,e];return i}function s(t,e){var n=[];return n[0]=t[0]*e[0]+t[1]*e[3]+t[2]*e[6],n[1]=t[0]*e[1]+t[1]*e[4]+t[2]*e[7],n[2]=t[0]*e[2]+t[1]*e[5]+t[2]*e[8],n[3]=t[3]*e[0]+t[4]*e[3]+t[5]*e[6],n[4]=t[3]*e[1]+t[4]*e[4]+t[5]*e[7],n[5]=t[3]*e[2]+t[4]*e[5]+t[5]*e[8],n[6]=t[6]*e[0]+t[7]*e[3]+t[8]*e[6],n[7]=t[6]*e[1]+t[7]*e[4]+t[8]*e[7],n[8]=t[6]*e[2]+t[7]*e[5]+t[8]*e[8],n}function r(){var t=n(a.alpha,a.beta,a.gamma),e=i(c),r=s(t,e),l=o(),h=s(r,l);return h}var a={alpha:0,beta:0,gamma:0},c=0,l=Math.PI/180,h=function(t){a.alpha=t.alpha,a.beta=t.beta,a.gamma=t.gamma;var e=r(),n=[-e[0],-e[2],-e[1],0,-e[3],-e[5],-e[4],0,-e[6],-e[8],-e[7],0,0,0,0,1],i="matrix3d("+n.join(",")+")";return i};e.exports=h}),define("mods/view/room",function(require,t,e){var n=require("lib"),i=require("lib/mvc/view"),o=require("mods/view/wall"),s=require("mods/view/floor"),r=require("mods/view/ceiling"),a=require("mods/model/room"),c=require("mods/model/touchPad"),l=require("lib/common/channel"),h=i.extend({defaults:{name:"room",path:"",env:null,personModel:null,coordinateSystem:null},build:function(){var t=this.conf;this.path=[t.path,t.name].join("."),this.env=t.env,this.model=new a,this.personModel=t.personModel,this.coordinateSystem=t.coordinateSystem,this.buildGround(),this.buildFloor(),this.buildWalls(),this.buildCeiling(),this.updateSize(),this.updateEyePos()},setEvents:function(t){var e=this.model,n=this.proxy(),i=this.personModel;this.delegate(t),e.on("change:widthPx",n("updateSize")),e.on("change:heightPx",n("updateSize")),e.on("change:extentPx",n("updateSize")),i.on("change:eyeHeight",n("updateEyePos")),l.on("room-show-face",n("showFace")),l.on("room-hide-face",n("hideFace"))},buildGround:function(){var t=this;this.env.getRatio=function(){return t.model.get("ratio")},this.ground=n('<div class="ground" name="ground"></div>'),this.ground.appendTo(this.coordinateSystem.role("root"))},buildFloor:function(){var t=this.model;this.floor=new s({path:this.path,env:this.env,ground:this.ground,width:t.get("widthPx"),height:t.get("extentPx")})},buildWalls:function(){var t=this.model,e=t.get("extentPx"),n=t.get("widthPx"),i=t.get("heightPx");this.left=new o({name:"left",path:this.path,env:this.env,ground:this.ground,distance:n/2,width:e,height:i,type:"left"}),this.right=new o({name:"right",path:this.path,env:this.env,ground:this.ground,distance:n/2,width:e,height:i,type:"right"}),this.front=new o({name:"front",path:this.path,env:this.env,ground:this.ground,distance:e/2,width:n,height:i,type:"front"}),this.behind=new o({name:"behind",path:this.path,env:this.env,ground:this.ground,distance:e/2,width:n,height:i,type:"behind"})},buildCeiling:function(){var t=this.model;this.ceiling=new r({path:this.path,env:this.env,ground:this.ground,distance:t.get("heightPx"),width:t.get("widthPx"),height:t.get("extentPx")})},updateEyePos:function(){var t=this.personModel.get("eyeHeight"),e=this.personModel.get("padHeight"),n=this.model.get("ratio"),i=t*n,o=e*n;this.ground.transform({translateX:"0",translateY:"0",translateZ:i+"px",rotateX:"180deg",rotateZ:"180deg"}),c.set({padHeight:o,eyeHeight:i})},updateSize:function(){{var t=this.model,e=t.get("extentPx"),n=t.get("widthPx");t.get("heightPx")}this.ground.css({"margin-left":0-n/2+"px","margin-top":0-e/2+"px",width:n+"px",height:e+"px"})},hideFace:function(){this.floor.hide(),this.ceiling.hide(),this.left.hide(),this.right.hide(),this.front.hide(),this.behind.hide()},showFace:function(){this.floor.show(),this.ceiling.show(),this.left.show(),this.right.show(),this.front.show(),this.behind.show()},update:function(t){var e=this;t=t||{},this.model.set(t.room),["floor","ceiling","front","behind","left","right"].forEach(function(n){e[n].update(t[n])})},toJSON:function(){var t=this,e={};return e.room=this.model.get(),["floor","ceiling","front","behind","left","right"].forEach(function(n){e[n]=t[n].toJSON()}),e}});e.exports=h}),define("lib/mvc/controller",function(require,t,e){var n=require("lib"),i=require("lib/mvc/base"),o=require("lib/mvc/delegate"),s=function(t){this.objs&&n.each(this.objs,function(e,i){i&&n.isFunction(i[t])&&i[t]()})},r=i.extend({defaults:{node:null,events:{}},initialize:function(t){this.objs={},this.setOptions(t),this.root=n(this.conf.node),this.build(),this.attach()},setEvents:function(t){this.delegate(t)},delegate:function(t,e,n,i){t=t||"on",e=e||this.root,n=n||this.conf.events,i=i||this,o(t,e,n,i)},attach:function(){this.attached||(this.setEvents("on"),s.call(this,"attach"),this.trigger("attach"),this.attached=!0)},detach:function(){this.attached&&(this.attached=!1,this.trigger("detach"),s.call(this,"detach"),this.setEvents("off"))},destroy:function(){s.call(this,"destroy"),this.detach(),this.delegate("off"),this.off(),this.objs=null,this.bound=null}});e.exports=r}),define("mods/view/backgroundSelector",function(require,t,e){var n=(require("lib"),require("lib/kit/util/template")),i=(require("lib/mvc/model"),require("lib/mvc/view")),o=require("mods/channel/socket"),s=require("mods/model/slide"),r=require("lib/more/mustache"),a=n({box:['<div class="bg-selector"></div>'],item:['{{#.}}<div class="item" style="background-image:url({{.}});"></div>{{/.}}']}),c=i.extend({defaults:{env:null,template:a.box},build:function(){var t=this.conf;this.env=t.env,this.model=s,this.render()},setEvents:function(){var t=this.model,e=this.proxy();t.on("change:plane",e("selectPlane")),t.on("change:currentPic",e("render")),o.on("gallery",e("onSync"))},onSync:function(t){this.model.set(t)},render:function(){var t=this.model,e=this.role("root"),n=t.pics;if(!this.items){var i=a.get("item"),o=r.render(i,n);e.html(o),this.items=e.find(".item")}var s=this.items,c=[],l=[],h=0,u=t.get("currentPic");for(h=0;u>h;h++)c.push(h);for(h=u+1;h<n.length;h++)l.push(h);c.reverse().forEach(function(t,e){e=Math.min(e,2),s.get(t).className="item prev"+e}),s.get(u).className="item cur",l.forEach(function(t,e){e=Math.min(e,2),s.get(t).className="item next"+e})},toggle:function(t){var e=this.model,n=e.get("plane");t?t===n?e.set("plane",""):e.set("plane",t):e.set("plane","")},selectPlane:function(){var t=this.model,e=(this.role("root"),t.get("plane")),n=this;this.hideSlides(function(){e&&n.showSlides(e)})},showSlides:function(t){var e=this.role("root"),n=this.env.getObjByPath(t),i=n.surface.get("content").role("root");e.css({width:"400px",height:"200px",opacity:0}).appendTo(i),e.transit({opacity:1,translateX:"-50%",translateZ:"100px"},300,"ease-in")},hideSlides:function(t){var e=this.role("root");e.parent().get(0)?e.transit({opacity:0,translateX:"-50%",translateZ:0},300,"ease-in",function(){e.remove(),t()}):t()}});e.exports=c}),define("lib/more/class",function(require,t,e){function n(t){return this instanceof n||!u(t)?void 0:o(t)}function i(t){var e,i;for(e in t)i=t[e],n.Mutators.hasOwnProperty(e)?n.Mutators[e].call(this,i):this.prototype[e]=i}function o(t){return t.extend=n.extend,t.implement=i,t}function s(){}function r(t,e,n){for(var i in e)if(e.hasOwnProperty(i)){if(n&&-1===d(n,i))continue;"prototype"!==i&&(t[i]=e[i])}}function a(t){if(f){var e=f();if(e){var n=e.uri.split(/[\/\\]/).pop();Object.defineProperties?Object.defineProperties(t,{__module:{value:e},__filename:{value:n}}):(t.__module=e,t.__filename=n)}}}e.exports=n,n.create=function(t,e){function s(){t.apply(this,arguments),this.constructor===s&&this.initialize&&this.initialize.apply(this,arguments)}return u(t)||(e=t,t=null),e||(e={}),t||(t=e.Extends||n),e.Extends=t,t!==n&&r(s,t,t.StaticsWhiteList),i.call(s,e),o(s)},n.extend=function(t){return t||(t={}),t.Extends=this,n.create(t)},n.Mutators={Extends:function(t){var e=this.prototype,n=c(t.prototype);r(n,e),n.constructor=this,this.prototype=n,this.superclass=t.prototype,a(n)},Implements:function(t){h(t)||(t=[t]);for(var e,n=this.prototype;e=t.shift();)r(n,e.prototype||e)},Statics:function(t){r(this,t)}};var c=Object.__proto__?function(t){return{__proto__:t}}:function(t){return s.prototype=t,new s},l=Object.prototype.toString,h=Array.isArray;h||(h=function(t){return"[object Array]"===l.call(t)});var u=function(t){return"[object Function]"===l.call(t)},d=Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1},f=e.constructor._getCompilingModule}),define("mods/view/wall",function(require,t,e){var n=(require("lib"),require("lib/kit/util/template")),i=require("lib/kit/math/arcToDeg"),o=(require("lib/kit/math/degToArc"),require("mods/view/plane")),s=require("mods/model/wall"),r=require("mods/model/touchPad"),a=require("lib/common/channel"),c=require("mods/view/desktop"),l=n({box:'<div class="plane"></div>'}),h=o.extend({defaults:{name:"wall",path:"",ground:null,width:0,height:0,distance:0,type:"front",template:l.box},getModel:function(){var t=this.conf;this.model=new s({name:t.name,type:t.type,distance:t.distance,width:t.width,height:t.height})},setEvents:function(){h.superclass.setEvents.apply(this,arguments);var t=this.proxy();a.on("on-tv-tap",t("showDesktop"))},setPos:function(){var t=this.conf,e=this.model,n=this.role("root"),i=e.get("type");n.attr("name",t.name);var o=(e.get("width"),e.get("height")),s=e.get("distance");s-=1,"left"===i?n.transform({rotateX:"-90deg",rotateY:"90deg",translateY:0-o/2+"px",translateZ:0-s+"px"}):"right"===i?n.transform({rotateX:"-90deg",rotateY:"-90deg",translateY:0-o/2+"px",translateZ:0-s+"px"}):"behind"===i?n.transform({rotateX:"-90deg",rotateY:"180deg",translateY:0-o/2+"px",translateZ:0-s+"px"}):"front"===i&&n.transform({rotateX:"-90deg",translateY:0-o/2+"px",translateZ:0-s+"px"})},buildSurface:function(){var t=this.surface;t.load("background"),t.load("light"),t.load("mask"),t.load("content"),t.load("animate")},getLimitDeg:function(){var t=this.model,e=t.get("width"),n=t.get("height"),o=this.getVerticalDistance(),s=r.get("padHeight"),a={};return a.alphaMin=i(Math.atan(-e/2/o)),a.alphaMax=i(Math.atan(e/2/o)),a.betaMin=i(Math.atan(-s/o)),a.betaMax=i(Math.atan((n-s)/o)),a},getVerticalDeg:function(){var t=this.model,e=t.get("type"),n={};return"left"===e?(n.alpha=90,n.beta=0):"right"===e?(n.alpha=270,n.beta=0):"behind"===e?(n.alpha=180,n.beta=0):"front"===e&&(n.alpha=0,n.beta=0),n},getDeltaDeg:function(){var t=r.get(),e=this.getVerticalDeg(),n=t.alpha-e.alpha;return n=n>180?n-360:n,n=-180>n?360+n:n,t.alpha=n,t},getVerticalPos:function(){var t=r.get("padHeight"),e=this.model;return{x:e.get("width")/2,y:e.get("height")-t}},showDesktop:function(){var t=this.surface;if(!this.desktop){var e=t.get("mask");e&&e.tv&&(this.desktop=new c({tv:e.tv,plane:this}))}this.desktop&&this.desktop.show()}});e.exports=h}),define("mods/view/floor",function(require,t,e){var n=(require("lib"),require("lib/kit/util/template")),i=require("lib/kit/math/arcToDeg"),o=require("lib/kit/math/degToArc"),s=require("mods/view/plane"),r=require("mods/model/floor"),a=require("mods/model/touchPad"),c=n({box:'<div class="plane"></div>'}),l=s.extend({defaults:{name:"floor",path:"",ground:null,width:0,height:0,template:c.box},getModel:function(){var t=this.conf;this.model=new r({name:t.name,width:t.width,height:t.height})},setPos:function(){var t=this.role("root");t.attr("name","floor")},buildSurface:function(){var t=this.surface;t.load("background"),t.load("light"),t.load("mask"),t.load("content"),t.load("animate")},getVerticalDistance:function(){return a.get("padHeight")},getLimitDeg:function(){var t=this.model,e=t.get("width"),n=t.get("height"),o=this.getVerticalDistance(),s={};return s.alphaMin=-180,s.alphaMax=180,s.betaMax=i(Math.atan(Math.max(e,n)/o))-90,s.betaMin=-90,s},getDeltaDeg:function(){var t=a.get(),e=t.alpha;return e=e>180?e-360:e,e=-180>e?360+e:e,t.alpha=e,t},getPadPointPos:function(){var t=this.getDeltaDeg(),e=this.getVerticalPos(),n=90-Math.abs(t.beta),i={x:0,y:0},s=this.getVerticalDistance();return i.x=e.x-s*Math.tan(o(n))*Math.sin(o(t.alpha)),i.y=e.y-s*Math.tan(o(n))*Math.cos(o(t.alpha)),i}});e.exports=l}),define("mods/view/ceiling",function(require,t,e){var n=(require("lib"),require("lib/kit/util/template")),i=require("lib/kit/math/arcToDeg"),o=require("lib/kit/math/degToArc"),s=require("mods/view/plane"),r=require("mods/model/ceiling"),a=require("mods/model/touchPad"),c=n({box:'<div class="plane"></div>'}),l=s.extend({defaults:{name:"ceiling",path:"",ground:null,width:0,height:0,distance:0,template:c.box},getModel:function(){var t=this.conf;this.model=new r({name:t.name,width:t.width,height:t.height,distance:t.distance})},setPos:function(){var t=this.role("root");t.attr("name","ceiling");var e=this.model;t.transform({translateZ:e.get("distance")-1+"px",rotateX:"180deg"})},buildSurface:function(){var t=this.surface;t.load("background"),t.load("light"),t.load("mask"),t.load("content"),t.load("animate")},getVerticalDistance:function(){var t=this.model.get("distance");return t-a.get("padHeight")},getLimitDeg:function(){var t=this.model,e=t.get("width"),n=t.get("height"),o=this.getVerticalDistance(),s={};return s.alphaMin=-180,s.alphaMax=180,s.betaMax=90,s.betaMin=90-i(Math.atan(Math.max(e,n)/o)),s},getDeltaDeg:function(){var t=a.get(),e=t.alpha;return e=e>180?e-360:e,e=-180>e?360+e:e,t.alpha=e,t},getPadPointPos:function(){var t=this.getDeltaDeg(),e=this.getVerticalPos(),n=90-Math.abs(t.beta),i={x:0,y:0},s=this.getVerticalDistance();return i.x=e.x-s*Math.tan(o(n))*Math.sin(o(t.alpha)),i.y=e.y+s*Math.tan(o(n))*Math.cos(o(t.alpha)),i}});e.exports=l}),define("mods/model/room",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=n.extend({defaults:{ratio:200,extent:4,width:3,height:2.8,extentPx:0,widthPx:0,heightPx:0},events:{"change:extent":"computeSize","change:width":"computeSize","change:height":"computeSize"},build:function(){this.computeSize()},computeSize:function(){var t=this.get("extent"),e=this.get("width"),n=this.get("height"),i={},o=this.get("ratio");i.extentPx=t*o,i.widthPx=e*o,i.heightPx=n*o,this.set(i)}});e.exports=i
}),define("lib/common/channel",function(require,t,e){var n=require("lib/common/listener");e.exports=new n(["back-to-room","room-show-face","room-hide-face","on-tv-tap","on-desktop-hide"])}),define("mods/model/slide",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=["","/images/floor/floor1.jpg","/images/wall/wall1.jpg","/images/wall/wall2.jpg","/images/wall/wall3.jpg","/images/wall/wall4.jpg","/images/wall/wall5.jpg","/images/wall/wall6.jpg","/images/wall/wall7.jpg","/images/wall/wall8.jpg","/images/wall/wall9.jpg","/images/wall/wall10.jpg","/images/wall/wall11.jpg","/images/wall/wall12.jpg"],o=n.extend({defaults:{plane:"",currentPic:0},build:function(){this.pics=i}});e.exports=new o}),define("lib/more/mustache",function(require,t,e){var n=require("vendor/mustache");e.exports=n}),define("lib/kit/math/arcToDeg",function(require,t,e){e.exports=function(t){return 180*t/Math.PI}}),define("lib/kit/math/degToArc",function(require,t,e){e.exports=function(t){return Math.PI*t/180}}),define("mods/view/plane",function(require,t,e){var n=(require("lib"),require("lib/mvc/view")),i=require("lib/kit/num/limit"),o=require("lib/kit/util/template"),s=(require("lib/kit/math/arcToDeg"),require("lib/kit/math/degToArc")),r=require("mods/model/plane"),a=require("mods/ctrl/surface"),c=require("mods/model/pointer"),l=require("mods/model/touchPad"),h=require("mods/channel/socket"),u=(require("lib/common/channel"),o({box:'<div class="plane"></div>'})),d=n.extend({defaults:{name:"plane",path:"",env:null,ground:null,width:0,height:0,template:u.box},build:function(){var t=this.conf;this.path=[t.path,t.name].join("."),this.env=t.env,this.ground=t.ground,this.getModel(),this.getPointerModel(),this.getSurface(),this.create(),this.setSize(),this.setPos(),this.setStyle(),this.buildSurface()},setEvents:function(t){var e=this.role("root"),n=this.model,i=this.proxy();this.delegate(t),n.on("change",i("sync")),n.on("change:width",i("setSize")),n.on("change:height",i("setSize")),n.on("change:visible",i("checkVisible")),l.on("change",i("updatePointer")),e.on("mouseenter",i("onPointerEnter")),e.on("mouseleave",i("onPointerLeave")),h.on(this.path+":sync",i("onSync")),e.on("click",i("toggleBgSelector")),h.on("change-background",i("changeBackground"))},getModel:function(){var t=this.conf;this.model=new r({width:t.width,height:t.height})},getPointerModel:function(){this.pointerModel=new c({x:0,y:0})},getSurface:function(){this.surface=new a({path:this.path,env:this.env,parent:this})},create:function(){this.role("root").appendTo(this.ground)},sync:function(){h.trigger(this.path+":sync",this.model.get())},onSync:function(t){this.model.set(t)},onPointerEnter:function(){this.model.set("hover",!0)},onPointerLeave:function(){this.model.set("hover",!1)},toggleBgSelector:function(){h.trigger("toggle-bg-selector",this.path)},changeBackground:function(t){t&&t.path===this.path&&this.surface.get("background").updateBackgroundImage(t.pic)},setSize:function(){var t=this.model,e=this.role("root"),n=t.get("width"),i=t.get("height");e.css({width:n+"px",height:i+"px","margin-left":0-n/2+"px","margin-top":0-i/2+"px"})},setPos:function(){},setStyle:function(){},bePointedTo:function(){var t=this.getDeltaDeg(),e=this.getLimitDeg();if(t.alpha>e.alphaMin&&t.alpha<e.alphaMax&&t.beta>e.betaMin&&t.beta<e.betaMax){var n=this.model,i=this.getPadPointPos(),o=n.get("width"),s=n.get("height");return i.x>0&&i.x<o&&i.y>0&&i.y<s}return!1},getLimitDeg:function(){return{alphaMin:-180,alphaMax:180,betaMin:-90,betaMax:90}},getDeltaDeg:function(){return l.get()},getPadPointPos:function(){var t=this.getDeltaDeg(),e=this.getVerticalPos(),n={x:0,y:0},i=this.getVerticalDistance();return n.x=e.x-i*Math.tan(s(t.alpha)),n.y=e.y-i*Math.tan(s(t.beta))/Math.abs(Math.cos(s(t.alpha))),n},getPointerPos:function(){var t=this.model,e=this.getPadPointPos(),n=t.get("width"),o=t.get("height");return e.x=i(e.x,0,n),e.y=i(e.y,0,o),e},getVerticalPos:function(){var t=this.model;return{x:t.get("width")/2,y:t.get("height")/2}},getVerticalDistance:function(){return this.model.get("distance")},updatePointer:function(){var t=this.pointerModel,e=this.bePointedTo();this.model.set("bePointed",e);var n={x:0,y:0};e&&(n=this.getPointerPos(),t.set({x:n.x,y:n.y}))},buildSurface:function(){var t=this.surface;t.load("background"),t.load("light"),t.load("mask"),t.load("content"),t.load("animate")},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},checkVisible:function(){this.model.get("visible")?this.fxIn():this.fxOut()},fxIn:function(){var t=this.role("root"),e=this.surface,n=e.get("mask");n.door?setTimeout(function(){e.get("background").fxIn(),e.get("light").fxIn()},1500):"floor"===this.conf.name?(e.get("background").unfold(),e.get("light").unfold()):setTimeout(function(){t.show().css({opacity:0}).transit({opacity:1},1e3,"ease")},3e3)},fxOut:function(){var t=this.role("root"),e=this.surface,n=e.get("mask");n.door?setTimeout(function(){e.get("background").fxOut(),e.get("light").fxOut()},1500):"floor"===this.conf.name?setTimeout(function(){e.get("background").fold(),e.get("light").fold()},3e3):t.css({opacity:1}).transit({opacity:0},1e3,"ease",function(){t.hide()})},update:function(t){t=t||{},this.surface.update(t.surface)},toJSON:function(){var t={};return t.surface=this.surface.toJSON(),t}});e.exports=d}),define("mods/model/wall",function(require,t,e){var n=(require("lib"),require("mods/model/plane")),i=n.extend({});e.exports=i}),define("mods/view/desktop",function(require,t,e){var n=require("lib"),i=require("lib/mvc/model"),o=require("lib/mvc/view"),s=require("lib/kit/util/template"),r=require("mods/channel/socket"),a=require("lib/common/channel"),c=require("mods/view/browser"),l=require("mods/view/panorama"),h=72,u=36,d={chrome:"images/icon/icon1.png",draw:"images/icon/icon2.png",star:"images/icon/icon3.png",download:"images/icon/icon4.png",apple:"images/icon/icon5.png",music:"images/icon/icon6.png",tools:"images/icon/icon7.png",weather:"images/icon/icon8.png",entertainment:"images/icon/icon9.png"},f=Object.keys(d).length,p=s({box:['<div class="desktop"></div>']}),g=o.extend({defaults:{template:p.box,tv:null,plane:null},build:function(){var t=this.conf;this.tv=t.tv,this.plane=t.plane,this.env=this.plane.env,this.parent=this.plane.surface.get("content").role("root"),this.model=new i({visible:!1,width:this.plane.model.get("width"),height:this.plane.model.get("height")});var e=this.role("root");e.appendTo(this.parent),this.setStyles(),this.fillIcons()},setEvents:function(){var t=this.proxy(),e=this.model,n=this.plane;e.on("change:visible",t("checkVisible")),r.on("touchpad:event",t("checkEvent")),n.pointerModel.on("change",t("checkHover")),n.model.on("change:bePointed",t("checkHover")),a.on("room-show-face",t("checkFocus"))},setStyles:function(){var t=this.role("root"),e=this.model.get("width"),n=this.model.get("height");this.model.set({width:e,height:n}),t.css({"background-repeat":"no-repeat","background-size":"cover","background-image":"url(images/wallpaper/wp1.jpg)",position:"absolute",width:e+"px",height:n+"px",left:0,top:0,"transform-origin":"0% 0%","transform-style":"preserve-3d",transform:"translate3d(0,0,0)"})},focus:function(){this.model.set("focus",!0)},blur:function(){this.model.set("focus",!1)},getPanorama:function(){return this.panorama||(this.panorama=new l({env:this.env,ground:this.plane.ground})),this.panorama},openPanorama:function(){a.trigger("room-hide-face"),this.getPanorama().show()},getBrowser:function(){return this.browser||(this.browser=new c({plane:this.plane,parent:this.role("root")})),this.browser},openBrowser:function(){this.getBrowser().show()},checkHover:function(){var t=this.conf.plane,e=t.pointerModel.get(),i=this.model.get("width"),o=this.model.get("height");if(!t.model.get("bePointed")||!this.model.get("visible")||!this.icons||!this.model.get("focus")||e.x<0||e.y<0||e.x>i||e.y>o)return this.unHover(),void 0;var s=0,r=h,a=u,c=Math.floor(i/(r+a)),l=Math.floor((e.x-a)/(r+a)),d=Math.floor((e.y-a)/(r+a)),p=(e.x-a)%(r+a),g=(e.y-a)%(r+a);if(0>l||0>d)return this.unHover(),void 0;if(!(r>p&&r>g))return this.unHover(),void 0;if(s=d*c+l+1,s>f)return this.unHover(),void 0;if(s){var m=this.icons.get(s-1);if(!m)return this.unHover(),void 0;this.curHover&&this.curHover.get(0)!==m&&this.unHover();var v=n(m);this.curHover=v,v.css({"box-shadow":"rgba(255,255,255,0.5) 0 0 10px 10px"})}else this.unHover()},unHover:function(){this.curHover&&(this.curHover.css({"box-shadow":"none"}),this.curHover=null)},checkFocus:function(){var t=this;setTimeout(function(){t.focus()},4e3)},checkEvent:function(t){if(t=t||{},this.model.get("visible")&&t.type&&this.plane.model.get("bePointed"))if("pinch-out"===t.type)this.hide();else if("tap"===t.type&&this.curHover){var e=this.curHover.attr("iconname");"chrome"===e?(this.blur(),this.openBrowser()):"draw"===e&&(this.blur(),this.openPanorama())}},fillIcons:function(){var t=[],e=this.role("root"),i=h,o=u,s=(this.plane,this.model.get("width")),r=Math.floor(s/(i+o)),a=0,c=0,l=0,f=0,p=0;n.each(d,function(e,n){a=p%r,c=Math.floor(p/r),l=o+a*(i+o),f=o+c*(i+o),t.push(["<img",'class="icon"','iconname="'+e+'"','src="'+n+'"','style="left:'+l+"px;top:"+f+'px"',"/>"].join(" ")),p++}),e.html(t.join("")),this.icons=e.find(".icon"),this.icons.css({"border-radius":i+"px",position:"absolute",width:i+"px",height:i+"px",opacity:0}).transform({translateZ:"150px"})},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},checkVisible:function(){var t=this.model.get("visible");t?this.fxIn():this.fxOut()},showIcons:function(){this.role("root").find(".icon").each(function(){var t=n(this);setTimeout(function(){t.transit({opacity:1,translateZ:0},1e3,"ease-out",function(){t.css("transform","")})},1e3*Math.random())})},hideIcons:function(){this.role("root").find(".icon").css({opacity:0}).transform({translateZ:"150px"})},fxIn:function(){var t=this,e=this.tv,n=this.model,i=this.role("root"),o=this.env.getRatio(),s=e.conf.width*o,r=e.conf.screenHeight*o,a=e.conf.left*o,c=e.conf.top*o,l=s/n.get("width"),h=r/n.get("height");i.show().transform({translateX:a+"px",translateY:c+"px",translateZ:"1px",scaleX:l,scaleY:h}),i.transit({translateX:0,translateY:0,translateZ:"1px",scaleX:1,scaleY:1},1e3,"ease-out",function(){i.css("transform",""),t.showIcons(),t.focus()})},fxOut:function(){var t=this,e=this.tv,n=this.model,i=this.role("root"),o=this.env.getRatio(),s=e.conf.width*o,r=e.conf.screenHeight*o,c=e.conf.left*o,l=e.conf.top*o,h=s/n.get("width"),u=r/n.get("height");t.blur(),i.transform({translateX:0,translateY:0,translateZ:"1px",scaleX:1,scaleY:1}),i.transit({translateX:c+"px",translateY:l+"px",translateZ:"1px",scaleX:h,scaleY:u},1e3,"ease-out",function(){t.hideIcons(),i.hide(),a.trigger("on-desktop-hide")})}});e.exports=g}),define("mods/model/floor",function(require,t,e){var n=(require("lib"),require("mods/model/plane")),i=n.extend({});e.exports=i}),define("mods/model/ceiling",function(require,t,e){var n=(require("lib"),require("mods/model/plane")),i=n.extend({});e.exports=i}),define("lib/common/listener",function(require,t,e){var n=(require("lib"),require("lib/more/events")),i=function(t){this._whiteList={},this._receiver=new n,Array.isArray(t)&&t.forEach(this.define.bind(this))};i.prototype={constructor:i,define:function(t){this._whiteList[t]=!0},undefine:function(t){delete this._whiteList[t]},on:function(){this._receiver.on.apply(this._receiver,arguments)},off:function(){this._receiver.off.apply(this._receiver,arguments)},trigger:function(t){var e=[].slice.call(arguments,1);t=t.split(/\s+/),t.forEach(function(t){this._whiteList[t]&&this._receiver.trigger.apply(this._receiver,[t].concat(e))}.bind(this))}},e.exports=i}),define("vendor/mustache",function(require,t){function e(t,e){return RegExp.prototype.test.call(t,e)}function n(t){return!e(p,t)}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t){return String(t).replace(/[&<>"'\/]/g,function(t){return x[t]})}function s(t){this.string=t,this.tail=t,this.pos=0}function r(t,e){this.view=t,this.parent=e,this._cache={}}function a(){this.clearCache()}function c(e,n,i,o){for(var s,r,a,l="",h=0,u=e.length;u>h;++h)switch(s=e[h],r=s[1],s[0]){case"#":if(a=i.lookup(r),"object"==typeof a)if(b(a))for(var d=0,f=a.length;f>d;++d)l+=c(s[4],n,i.push(a[d]),o);else a&&(l+=c(s[4],n,i.push(a),o));else if("function"==typeof a){var p=null==o?null:o.slice(s[3],s[5]);a=a.call(i.view,p,function(t){return n.render(t,i)}),null!=a&&(l+=a)}else a&&(l+=c(s[4],n,i,o));break;case"^":a=i.lookup(r),(!a||b(a)&&0===a.length)&&(l+=c(s[4],n,i,o));break;case">":a=n.getPartial(r),"function"==typeof a&&(l+=a(i));break;case"&":a=i.lookup(r),null!=a&&(l+=a);break;case"name":a=i.lookup(r),null!=a&&(l+=t.escape(a));break;case"text":l+=r}return l}function l(t){for(var e,n=[],i=n,o=[],s=0,r=t.length;r>s;++s)switch(e=t[s],e[0]){case"#":case"^":o.push(e),i.push(e),i=e[4]=[];break;case"/":var a=o.pop();a[5]=e[2],i=o.length>0?o[o.length-1][4]:n;break;default:i.push(e)}return n}function h(t){for(var e,n,i=[],o=0,s=t.length;s>o;++o)e=t[o],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(n=e,i.push(e)));return i}function u(t){return[new RegExp(i(t[0])+"\\s*"),new RegExp("\\s*"+i(t[1]))]}t.name="mustache.js",t.version="0.7.2",t.tags=["{{","}}"],t.Scanner=s,t.Context=r,t.Writer=a;var d=/\s*/,f=/\s+/,p=/\S/,g=/\s*=/,m=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/,b=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t.escape=o,s.prototype.eos=function(){return""===this.tail},s.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},s.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return e},r.make=function(t){return t instanceof r?t:new r(t)},r.prototype.push=function(t){return new r(t,this)},r.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."==t)e=this.view;else for(var n=this;n;){if(t.indexOf(".")>0){e=n.view;for(var i=t.split("."),o=0;e&&o<i.length;)e=e[i[o++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},a.prototype.clearCache=function(){this._cache={},this._partialCache={}},a.prototype.compile=function(e,n){var i=this._cache[e];if(!i){var o=t.parse(e,n);i=this._cache[e]=this.compileTokens(o,e)}return i},a.prototype.compilePartial=function(t,e,n){var i=this.compile(e,n);return this._partialCache[t]=i,i},a.prototype.getPartial=function(t){return t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t)),this._partialCache[t]},a.prototype.compileTokens=function(t,e){var n=this;return function(i,o){if(o)if("function"==typeof o)n._loadPartial=o;else for(var s in o)n.compilePartial(s,o[s]);return c(t,n,r.make(i),e)}},a.prototype.render=function(t,e,n){return this.compile(t)(e,n)},t.parse=function(e,o){function r(){if(M&&!E)for(;S.length;)delete P[S.pop()];else S=[];M=!1,E=!1}if(e=e||"",o=o||t.tags,"string"==typeof o&&(o=o.split(f)),2!==o.length)throw new Error("Invalid tags: "+o.join(", "));for(var a,c,p,b,x,w=u(o),y=new s(e),k=[],P=[],S=[],M=!1,E=!1;!y.eos();){if(a=y.pos,p=y.scanUntil(w[0]))for(var T=0,j=p.length;j>T;++T)b=p.charAt(T),n(b)?S.push(P.length):E=!0,P.push(["text",b,a,a+1]),a+=1,"\n"==b&&r();if(!y.scan(w[0]))break;if(M=!0,c=y.scan(v)||"name",y.scan(d),"="===c?(p=y.scanUntil(g),y.scan(g),y.scanUntil(w[1])):"{"===c?(p=y.scanUntil(new RegExp("\\s*"+i("}"+o[1]))),y.scan(m),y.scanUntil(w[1]),c="&"):p=y.scanUntil(w[1]),!y.scan(w[1]))throw new Error("Unclosed tag at "+y.pos);if(x=[c,p,a,y.pos],P.push(x),"#"===c||"^"===c)k.push(x);else if("/"===c){if(0===k.length)throw new Error('Unopened section "'+p+'" at '+a);var O=k.pop();if(O[1]!==p)throw new Error('Unclosed section "'+O[1]+'" at '+a)}else if("name"===c||"{"===c||"&"===c)E=!0;else if("="===c){if(o=p.split(f),2!==o.length)throw new Error("Invalid tags at "+a+": "+o.join(", "));w=u(o)}}var O=k.pop();if(O)throw new Error('Unclosed section "'+O[1]+'" at '+y.pos);return P=h(P),l(P)};var w=new a;t.clearCache=function(){return w.clearCache()},t.compile=function(t,e){return w.compile(t,e)},t.compilePartial=function(t,e,n){return w.compilePartial(t,e,n)},t.compileTokens=function(t,e){return w.compileTokens(t,e)},t.render=function(t,e,n){return w.render(t,e,n)},t.to_html=function(e,n,i,o){var s=t.render(e,n,i);return"function"!=typeof o?s:(o(s),void 0)}}),define("lib/kit/num/limit",function(require,t,e){e.exports=function(t,e,n){return Math.min(Math.max(t,e),n)}}),define("mods/model/plane",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=n.extend({defaults:{name:"plane",type:"",bePointed:!1,distance:0,width:0,height:0,hover:!1},events:{},build:function(){}});e.exports=i}),define("mods/ctrl/surface",function(require,t,e){var n=require("lib"),i=require("lib/mvc/controller"),o=require("mods/view/surface/background"),s=require("mods/view/surface/light"),r=require("mods/view/surface/mask"),a=require("mods/view/surface/content"),c=require("mods/view/surface/animate"),l={background:o,light:s,mask:r,content:a,animate:c},h=i.extend({defaults:{name:"surface",path:"",env:"",parent:null},build:function(){var t=this.conf;this.path=[t.path,t.name].join("."),this.env=t.env,this.children={}},get:function(t){var e=this.children;return e[t]?e[t]:void 0},load:function(t,e){if(!this.children[t]){var i=this.conf,o=l[t];if(o){var s=n.extend({},e,{path:this.path,env:this.env,parent:i.parent}),r=new o(s);this.children[t]=r}}},update:function(t){var e=this.children;t=t||{},n.each(t,function(t,n){e[t]&&e[t].update?e[t].update(n):(this.load(t,n),e[t]&&e[t].update&&e[t].update(n))})},toJSON:function(){var t={};return n.each(this.children,function(e,n){t[e]=n.toJSON()}),t}});e.exports=h}),define("mods/model/pointer",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=n.extend({defaults:{x:0,y:0},events:{},build:function(){}});e.exports=i}),define("mods/view/browser",function(require,t,e){var n=require("lib"),i=require("lib/mvc/model"),o=require("lib/mvc/view"),s=require("lib/kit/util/template"),r=require("mods/channel/socket"),a=(require("lib/common/channel"),"/dpool/blog/s/blog_49ae54740102v6t7.html?pos=99&vt=4"),c=s({box:['<div class="browser">','<div data-role="box"></div>',"</div>"]}),l=o.extend({defaults:{plane:null,parent:null,template:c.box},build:function(){var t=this.conf;this.plane=t.plane,this.role("root").appendTo(t.parent),this.model=new i({visible:!1,width:this.plane.model.get("width"),height:this.plane.model.get("height")}),this.setStyles()},setEvents:function(){var t=this.model,e=this.plane,n=this.proxy();t.on("change:visible",n("checkVisible")),r.on("touchpad:event",n("checkEvent")),e.pointerModel.on("change",n("checkHover")),e.model.on("change:bePointed",n("checkHover"))},setStyles:function(){var t=this.model,e=this.role("root");e.css({position:"absolute",top:0,left:0,width:t.get("width")+"px",height:t.get("height")+"px",overflow:"hidden"}),this.role("box").css({overflow:"hidden",position:"absolute",top:0,left:0,width:t.get("width")+"px",height:t.get("height")+"px","background-color":"#fff"}).transform({translateY:t.get("height")+"px"})},fxIn:function(){var t=this,e=this.model,n=this.role("root");n.show(),this.role("box").transform({translateY:e.get("height")+"px"}).transit({translateY:0},500,"ease-out",function(){t.loadPage()})},fxOut:function(){var t=this,e=this.model,n=this.role("root");this.role("box").transit({translateY:e.get("height")+"px"},500,"ease-out",function(){n.hide(),t.plane.desktop&&t.plane.desktop.focus()})},checkHover:function(){var t=this.conf.plane,e=t.pointerModel.get();t.model.get("bePointed")&&this.model.get("visible")?this.model.set({hover:!0,pointerX:e.x,pointerY:e.y}):this.model.set({hover:!1,pointerX:0,pointerY:0})},checkEvent:function(t){t=t||{},t.type&&this.model.get("visible")&&this.model.get("hover")&&("pull"===t.type?this.hide():this.passEvents(t))},passEvents:function(t){var e=this.model,i=this.iframe;if(i){var o=i.get(0).contentWindow;if(o){var s=o.document;if("tap"===t.type){var r=e.get("pointerX"),a=e.get("pointerY"),c=s.elementFromPoint(r,a);n(c).trigger("tap")}else if("touchstart"===t.type)this.dragStartPos=t.y,this.startScrollPos=o.scrollY;else if("touchmove"===t.type){if(this.dragStartPos){var l=this.dragStartPos-t.y;this.startScrollPos=this.startScrollPos||0,o.scrollTo(0,this.startScrollPos+l)}}else"touchend"===t.type&&(this.dragStartPos=null,this.startScrollPos=o.scrollY)}}},loadPage:function(){this.iframe||(this.iframe=n("<iframe></iframe>").appendTo(this.role("box")),this.iframe.css({position:"absolute",width:this.model.get("width")+"px",height:this.model.get("height")+"px",overflow:"hidden",border:"none"}).attr("src",a))},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},checkVisible:function(){var t=this.model.get("visible");t?this.fxIn():this.fxOut()}});e.exports=l}),define("mods/view/panorama",function(require,t,e){var n=require("lib"),i=require("lib/kit/util/template"),o=require("lib/mvc/model"),s=require("lib/mvc/view"),r=(require("mods/channel/socket"),require("lib/common/channel")),a=(require("lib/kit/math/arcToDeg"),require("lib/kit/math/degToArc")),c=(require("mods/model/touchPad"),i({box:['<div class="panorama">','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>','<div class="panorama-item"></div>',"</div>"]})),l=["/images/pano/pano1.jpg","/images/pano/pano2.jpg","/images/pano/pano3.jpg","/images/pano/pano4.jpg"],h=s.extend({defaults:{ground:null,env:null,template:c.box},build:function(){var t=this.conf,e=this.role("root");this.env=t.env,this.model=new o({panoSrc:"",panoAngle:180,panoWidth:0,panoHeight:0}),this.ground=t.ground,e.appendTo(this.ground),this.screens=e.find(".panorama-item"),this.setStyles(),this.loadPano()},setEvents:function(){var t=this.model,e=this.proxy();t.on("change:visible",e("checkVisible")),r.on("back-to-room",e("hide"))},setStyles:function(){var t=this.role("root"),e=this.env.getRatio(),n=this.env.getObjByPath("vr.scene.house.room"),i=1.4;n&&n.personModel&&(i=n.personModel.get("eyeHeight"));var o=i*e;t.css({position:"absolute",width:"200px",height:"200px",left:"50%",top:"50%","margin-top":"-100px","margin-left":"-100px","transform-origin":"50% 50%","transform-style":"preserve-3d",transform:"rotateX(90deg) rotateZ(180deg) translateY(-"+o+"px)"})},render:function(){var t=this.model,e=this.screens.length,i=t.get("panoSrc"),o=t.get("panoAngle"),s=t.get("panoWidth")/e,r=t.get("panoHeight"),c=o/e,l=s/(2*Math.sin(a(c/2))),h=e/2*c-c/2;l-=l/45,this.screens.each(function(t){var e=n(this),o=h-t*c,a=-t*s;e.css({position:"absolute",top:"50%",left:"50%","margin-left":s/2+"px","margin-top":r/2+"px","background-color":"#fff","background-image":"url("+i+")","background-repeat":"no-repeat","background-position":a+"px 0",width:s+"px",height:r+"px"}).transform({rotateY:o+"deg",translateZ:-l+"px",translateY:-r+"px"})})},loadPano:function(){var t=this,e=this.model,n=l[3],i=new Image;i.onload=function(){e.set({panoSrc:n,panoWidth:i.width,panoHeight:i.height}),t.render()},i.src=n},fxIn:function(){this.role("root").show()},fxOut:function(){this.role("root").hide()},checkVisible:function(){this.model.get("visible")?this.fxIn():this.fxOut()},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1),r.trigger("room-show-face")}});e.exports=h}),define("mods/view/surface/background",function(require,t,e){var n=(require("lib"),require("mods/view/surface/base")),i=require("lib/kit/util/template"),o=require("mods/model/surface/background"),s=i({box:'<div class="surface" name="background"></div>'}),r=n.extend({defaults:{name:"background",path:"",env:null,template:s.box,parent:null},getModel:function(){this.model=new o({color:"#ddd",image:""})},setEvents:function(t){this.delegate(t);var e=this.proxy(),n=this.model;n.on("change:color",e("setStyles")),n.on("change:image",e("setStyles"))},setStyles:function(){var t=this.model,e=t.get("color"),n=t.get("image"),i=this.role("root"),o=this.parent.model;i.css({overflow:"hidden",width:o.get("width")+"px",height:o.get("height")+"px"}),n?i.css("background-image","url("+n+")"):e&&(i.css("background-image","none"),i.css("background-color",e))},updateBackgroundImage:function(t){this.model.set("image",t)}});e.exports=r}),define("mods/view/surface/light",function(require,t,e){var n=(require("lib"),require("mods/view/surface/base")),i=require("lib/kit/util/template"),o=require("mods/model/surface/light"),s=i({box:'<div class="surface" name="light"></div>'}),r=n.extend({defaults:{name:"light",path:"",env:null,template:s.box,parent:null},getModel:function(){this.model=new o},setStyles:function(){var t=(this.model,this.role("root")),e=this.parent.model;t.css({overflow:"hidden",width:e.get("width")+"px",height:e.get("height")+"px",background:"radial-gradient("+["farthest-corner at 60% 55%","rgba(255,255,255,0.5)","rgba(0,0,0,0.5)"].join()+")"})}});e.exports=r}),define("mods/view/surface/mask",function(require,t,e){var n=require("lib"),i=require("mods/view/surface/base"),o=require("lib/kit/util/template"),s=require("mods/model/surface/mask"),r=require("mods/channel/socket"),a=require("lib/common/channel"),c=require("mods/view/tv"),l=o({box:'<div class="surface" name="mask"></div>',door:['<div class="mask" name="door">','<div class="door-surface"></div>',"</div>"],window:['<div class="mask" name="window">','<div class="inner"></div>','<div class="outer"></div>',"</div>"]}),h=i.extend({defaults:{name:"mask",path:"",env:null,template:l.box,parent:null},getModel:function(){this.model=new s},setEvents:function(){var t=this.proxy(),e=this.model,n=this.conf.parent;e.on("change:door",t("setDoor")),e.on("change:window",t("setWindow")),e.on("change:tv",t("setTV")),n.pointerModel.on("change",t("checkHover")),n.model.on("change:bePointed",t("checkHover")),r.on("touchpad:event",t("checkEvent"))},setStyles:function(){var t=this.role("root"),e=this.parent.model;t.css({overflow:"hidden",width:e.get("width")+"px",height:e.get("height")+"px"})},setDoor:function(){var t=this.model,e=t.get("door"),i=this.role("root"),o=this.env,s=o.getRatio();if(e){this.door||(this.door=n(l.get("door")).appendTo(i));var r=this.conf.parent,a=r.model.get("height");this.door.css({position:"absolute",bottom:0,overflow:"hidden",left:e.left*s+"px","background-image":"url("+e.style+")","background-size":"cover","background-repeat":"no-repeat",width:e.width*s+"px",height:e.height*s+"px"}),this.doorOffset={left:e.left*s,top:a-e.height*s,right:e.left*s+e.width*s,bottom:a},this.door.find(".door-surface").css({position:"absolute",top:0,left:0,width:e.width*s+"px",height:e.height*s+"px"})}},setWindow:function(){var t=this.model,e=t.get("window"),i=this.role("root"),o=this.env,s=o.getRatio();e&&(this.win||(this.win={},this.win.box=n(l.get("window")).appendTo(i),this.win.outer=this.win.box.find(".outer"),this.win.inner=this.win.box.find(".inner")),this.win.box.css({position:"absolute",overflow:"hidden",top:e.top*s+"px",left:e.left*s+"px",width:e.width*s+"px",height:e.height*s+"px"}),this.win.inner.css({position:"absolute",top:0,left:0,"background-image":"url("+e.outer+")","background-size":"cover","background-repeat":"no-repeat",width:e.width*s+"px",height:e.height*s+"px"}),this.win.outer.css({position:"absolute",top:0,left:0,"background-image":"url("+e.style+")","background-size":"cover","background-repeat":"no-repeat",width:e.width*s+"px",height:e.height*s+"px"}))},setTV:function(){var t=this.model,e=t.get("tv"),i=this.role("root");e&&(this.tv||(this.tv=new c(n.extend({env:this.env,plane:this.conf.parent,parentNode:i},e))),this.tv.update(e))},checkEvent:function(t){t=t||{},t.type&&this.door&&this.door.attr("hover")&&"tap"===t.type&&a.trigger("back-to-room")},checkHover:function(){if(this.door&&this.doorOffset){var t=this.conf.parent,e=t.pointerModel.get(),n=this.doorOffset;t.model.get("bePointed")&&e.x>n.left&&e.x<n.right&&e.y>n.top&&e.y<n.bottom?this.door.attr("hover","y").find(".door-surface").css({"background-color":"rgba(255,255,255,0.5)"}):this.door.attr("hover","").find(".door-surface").css({"background-color":""})}}});e.exports=h}),define("mods/view/surface/content",function(require,t,e){var n=(require("lib"),require("mods/view/surface/base")),i=require("lib/kit/util/template"),o=require("mods/model/surface/content"),s=i({box:'<div class="surface" name="content"></div>'}),r=n.extend({defaults:{name:"content",path:"",env:null,template:s.box,parent:null},getModel:function(){this.model=new o}});e.exports=r}),define("mods/view/surface/animate",function(require,t,e){var n=require("lib"),i=require("mods/view/surface/base"),o=require("lib/kit/util/template"),s=require("mods/model/surface/animate"),r=require("mods/channel/socket"),a=o({box:'<div class="surface" name="animate"></div>',cursor:['<div class="laser-aiming-point">','<div class="laser-ring"></div>',"</div>"]}),c=i.extend({defaults:{name:"animate",path:"",env:null,template:a.box,parent:null},build:function(){c.superclass.build.apply(this,arguments),this.buildCursor(),this.setCursorVisibility(),this.setCursor()},setStyles:function(){var t=this.role("root"),e=this.parent.model;t.css({overflow:"hidden",width:e.get("width")+"px",height:e.get("height")+"px"})},setEvents:function(){var t=this.proxy(),e=this.parent;e.pointerModel.on("change",t("setCursor")),e.model.on("change:bePointed",t("setCursorVisibility")),e.model.on("change:hover",t("checkHover")),r.on("touchpad:event",t("checkEvent"))},getModel:function(){this.model=new s({})},buildCursor:function(){var t=this.role("root");this.cursor||(this.cursor=n(a.get("cursor")).appendTo(t),this.cursor.hide())},setCursorVisibility:function(){var t=this.parent.model;this.cursorVisible=t.get("bePointed"),this.cursorVisible?this.cursor.show():this.cursor.hide()},setCursor:function(){var t=this.parent,e=t.pointerModel;this.cursorVisible&&this.cursor.transform({translateX:e.get("x")+"px",translateY:e.get("y")+"px"})},checkEvent:function(t){if(t=t||{},this.cursorVisible&&t.type&&"tap"===t.type){var e=this.cursor.find(".laser-ring");e.hide(),e.reflow(),e.show()}},checkHover:function(){var t=this.role("root"),e=this.parent.model.get("hover");e?t.css("background-color","rgba(255,255,255,0.5)"):t.css("background-color","rgba(255,255,255,0)")},fxIn:function(){},fxOut:function(){}});e.exports=c}),define("mods/view/surface/base",function(require,t,e){var n=(require("lib"),require("lib/mvc/view")),i=require("lib/kit/util/template"),o=require("mods/model/surface/base"),s=i({box:'<div class="surface"></div>'}),r=n.extend({defaults:{name:"name",path:"",env:null,template:s.box,parent:null},build:function(){var t=this.conf;this.path=[t.path,t.name].join("."),this.env=t.env,this.parent=t.parent,this.getModel(),this.insert(),this.setSize(),this.setStyles()},setEvents:function(t){this.proxy();this.delegate(t)},getModel:function(){this.model=new o({})},insert:function(){var t=this.conf.parent;this.role("root").appendTo(t.role("root"))},setSize:function(){},setStyles:function(){var t=this.role("root"),e=this.parent.model;t.css({width:e.get("width")+"px",height:e.get("height")+"px"})},show:function(){this.role("root").show()},hide:function(){this.role("root").hide()
},fxIn:function(){var t=this.role("root");t.show().css({opacity:0}).transit({opacity:1},1e3,"ease")},fxOut:function(){var t=this.role("root");t.css({opacity:1}).transit({opacity:0},1e3,"ease",function(){t.hide()})},fold:function(){var t=this.role("root");t.css({position:"absolute",left:"50%",top:"50%","border-radius":0,overflow:"hidden"}).transform({translateX:"-50%",translateY:"-50%"}).transit({width:"200px",height:"200px","border-radius":"50%"},1e3,"ease")},unfold:function(){var t=this.role("root"),e=this.conf.parent;t.transit({width:e.model.get("width")+"px",height:e.model.get("height")+"px","border-radius":0},1e3,"ease")},update:function(t){this.model.set(t)},toJSON:function(){return this.model.get()}});e.exports=r}),define("mods/model/surface/background",function(require,t,e){var n=(require("lib"),require("mods/model/surface/base")),i=n.extend({});e.exports=i}),define("mods/model/surface/light",function(require,t,e){var n=(require("lib"),require("mods/model/surface/base")),i=n.extend({});e.exports=i}),define("mods/model/surface/mask",function(require,t,e){var n=(require("lib"),require("mods/model/surface/base")),i=n.extend({door:null,tv:null,window:null});e.exports=i}),define("mods/view/tv",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=require("lib/mvc/view"),o=require("lib/kit/util/template"),s=require("mods/channel/socket"),r=require("lib/common/channel"),a=o({box:['<div class="mask" name="tv">','<div class="bg"></div>','<div class="inner"></div>','<div class="outer"></div>',"</div>"]}),c=i.extend({defaults:{env:null,plane:null,parentNode:null,template:a.box},build:function(){var t=this.conf,e=this.role("root");this.model=new n({top:t.top,left:t.left,width:t.width,height:t.height,style:t.style,screenHeight:t.screenHeight}),this.state=new n({hover:!1,top:0,right:0,bottom:0,left:0}),this.env=t.env,e.appendTo(t.parentNode),this.bg=e.find(".bg"),this.inner=e.find(".inner"),this.outer=e.find(".outer"),this.setStyles()},setEvents:function(){var t=this.proxy(),e=this.model,n=this.conf.plane,i=this.state;e.on("change",t("setStyles")),i.on("change:hover",t("checkHoverStyle")),n.pointerModel.on("change",t("checkHover")),n.model.on("change:bePointed",t("checkHover")),s.on("touchpad:event",t("checkEvent")),r.on("on-desktop-hide",t("show"))},setStyles:function(){var t=this.role("root"),e=this.env,n=e.getRatio(),i=this.model,o=i.get();t.css({position:"absolute",overflow:"hidden",top:o.top*n+"px",left:o.left*n+"px",width:o.width*n+"px",height:o.height*n+"px"}),this.bg.css({position:"absolute",top:0,left:0,"background-image":"radial-gradient(farthest-corner at 60% 25%,#666, #000)",width:o.width*n+"px",height:o.screenHeight*n+"px"}),this.inner.css({position:"absolute",top:0,left:0,opacity:0,"background-image":"url(images/inner/inner1.gif)",transition:"opacity 0.3s ease",width:o.width*n+"px",height:o.screenHeight*n+"px"}),this.outer.css({position:"absolute",top:0,left:0,"background-image":"url("+o.style+")","background-size":"cover","background-repeat":"no-repeat",width:o.width*n+"px",height:o.height*n+"px"}),this.state.set({top:o.top*n,right:o.left*n+o.width*n,bottom:o.top*n+o.height*n,left:o.left*n})},checkHover:function(){var t=this.conf.plane,e=t.pointerModel.get(),n=this.state.get();t.model.get("bePointed")&&e.x>n.left&&e.x<n.right&&e.y>n.top&&e.y<n.bottom?this.state.set("hover",!0):this.state.set("hover",!1)},checkHoverStyle:function(){{var t=this.state;this.conf.plane}t.get("hover")?this.inner.css("opacity",1):this.inner.css("opacity",0)},checkEvent:function(t){t=t||{},this.state.get("hover")&&t.type&&"tap"===t.type&&(this.hide(),r.trigger("on-tv-tap"))},update:function(t){this.model.set(t)},show:function(){this.role("root").show()},hide:function(){this.role("root").hide()}});e.exports=c}),define("mods/model/surface/content",function(require,t,e){var n=(require("lib"),require("mods/model/surface/base")),i=n.extend({});e.exports=i}),define("mods/model/surface/animate",function(require,t,e){var n=(require("lib"),require("mods/model/surface/base")),i=n.extend({});e.exports=i}),define("mods/model/surface/base",function(require,t,e){var n=(require("lib"),require("lib/mvc/model")),i=n.extend({defaults:{},events:{},build:function(){}});e.exports=i}),define("conf/page/sight",function(require){var t=require("lib"),e=require("mods/view/scene"),n=require("mods/view/touchPad"),i=require("mods/channel/socket"),o=(new n({node:null}),[]);t(".vrscene").each(function(){var n=t(this),i=n.attr("type"),s=new e({node:n,path:"vr",isSightDevice:!0,type:i});o.push(s)}),i.on("scene:sync",function(t){o.forEach(function(e){e.update(t)})});var s=function(t){t&&t.preventDefault&&t.preventDefault()};t(document).on("touchstart",s),t(document).on("touchmove",s),t(document).on("touchend",s)});